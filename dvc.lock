schema: '2.0'
stages:
  prepare:
    cmd: pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 85c3e095791143d80182a43ba93d6462
      size: 7074969394
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 9595d9ce6358e8d50055d4cc02972766
      size: 119640743
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz
      | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica print
      --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =^ 'II '" dump/dbsm-titel-exemplare.dat.gz | pica select
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'II '"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III'" dump/dbsm-titel-exemplare.dat.gz | pica select
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'III'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica select
      --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'IV'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "044P/*.9 == '041799844'
      && 011@.a =~ '^([01xX][0-7xX][0-9xX][0-9xX])|([01xX][8][12][0-9xX])|([01xX][8][3][0])'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 9595d9ce6358e8d50055d4cc02972766
      size: 119640743
    outs:
    - path: filter/böink-exemplare.dat
      md5: 47887205cf7115265cbc07df4bbce82c
      size: 45136
    - path: filter/böink-titel.csv
      md5: adf2d8ca7e61c47f791625f93a290df1
      size: 19022
    - path: filter/böm-exemplare.dat
      md5: fe2c63891e321e9e621c10ad9190a57a
      size: 179903
    - path: filter/böm-titel.csv
      md5: ac523e4167184f137681802bff41c23c
      size: 127856
    - path: filter/ii-exemplare.dat
      md5: 6c1365a3ae8dea4a97999b4fc058b701
      size: 7068460
    - path: filter/ii-titel.csv
      md5: 19a58de9e8245307f0e216fa081f52c0
      size: 102567
    - path: filter/iii-exemplare.dat
      md5: d5e72095b933af27fa35caa9a42ff115
      size: 3155909
    - path: filter/iii-titel.csv
      md5: 9dffeee46a6063934fb8b051b2d5f30a
      size: 296847
    - path: filter/iv-exemplare.dat
      md5: 271bed2f9302ac8b26b8d9e9b987f23a
      size: 3805963
    - path: filter/iv-titel.csv
      md5: 04c80ef01937c32335f94964a422b50a
      size: 997410
    - path: filter/schreibmeister-exemplare.dat
      md5: 0014c789eb78c4607bfbb30c6e12bbc9
      size: 30824
    - path: filter/schreibmeister-titel.csv
      md5: 7df29fac2d4fd930d776f7b7ab08e60b
      size: 40671
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: cb55b7d1ea6ad89c56104ba23bab52ee
      size: 284
    - path: filter/böink-exemplare.dat
      md5: 47887205cf7115265cbc07df4bbce82c
      size: 45136
    - path: filter/böink-titel.csv
      md5: adf2d8ca7e61c47f791625f93a290df1
      size: 19022
    - path: filter/böm-exemplare.dat
      md5: fe2c63891e321e9e621c10ad9190a57a
      size: 179903
    - path: filter/böm-titel.csv
      md5: ac523e4167184f137681802bff41c23c
      size: 127856
    - path: filter/ii-exemplare.dat
      md5: 6c1365a3ae8dea4a97999b4fc058b701
      size: 7068460
    - path: filter/ii-titel.csv
      md5: 19a58de9e8245307f0e216fa081f52c0
      size: 102567
    - path: filter/iii-exemplare.dat
      md5: d5e72095b933af27fa35caa9a42ff115
      size: 3155909
    - path: filter/iii-titel.csv
      md5: 9dffeee46a6063934fb8b051b2d5f30a
      size: 296847
    - path: filter/iv-exemplare.dat
      md5: 271bed2f9302ac8b26b8d9e9b987f23a
      size: 3805963
    - path: filter/iv-titel.csv
      md5: 04c80ef01937c32335f94964a422b50a
      size: 997410
    - path: filter/schreibmeister-exemplare.dat
      md5: 0014c789eb78c4607bfbb30c6e12bbc9
      size: 30824
    - path: filter/schreibmeister-titel.csv
      md5: 7df29fac2d4fd930d776f7b7ab08e60b
      size: 40671
    - path: skripte/abzug.py
      md5: adf307c2145b71f4fb67b526b9ca5413
      size: 16025
    outs:
    - path: abzug/böink.csv
      md5: ee172b8a285eab341397467a1d9110f1
      size: 39887
    - path: abzug/böink.xlsx
      md5: 2602462ca40fb953907a2b9344cf98ba
      size: 27352
    - path: abzug/böm.csv
      md5: aa03c6f77e31bf6ae9ca8fe9134138be
      size: 108543
    - path: abzug/böm.xlsx
      md5: 805ace2542515798e6d871234bc287ae
      size: 66257
    - path: abzug/ii.csv
      md5: 1a64bbf7d2ada433b103d4414efac727
      size: 91454
    - path: abzug/ii.xlsx
      md5: f1c43fb91fe0b7764499dcb8fada5925
      size: 57560
    - path: abzug/iii.csv
      md5: e3c77ccb099ee6d119ed1a521c3b38c4
      size: 247162
    - path: abzug/iii.xlsx
      md5: 02e2061fd79ffedb72ce74a1388e2e96
      size: 139246
    - path: abzug/iv.csv
      md5: 55bb3875d13e6ad20f8b5e3085d8dc29
      size: 888579
    - path: abzug/iv.xlsx
      md5: 6141ce2013a6036510fd8d6d73fd2e40
      size: 463906
    - path: abzug/schreibmeister.csv
      md5: 34cd600ed2d1a9d1948f078cffb0f5a7
      size: 47479
    - path: abzug/schreibmeister.xlsx
      md5: 189ca7a89e3ec9bcdee320034e2713a3
      size: 32059
