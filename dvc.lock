schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: b922f443d085967c0e13faea11300c9f
      size: 9127799792
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: b891e381400b45033b7e50b7f763f692
      size: 139676816
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --merge
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed '/^209A.*\$x
      0[1-8]/d' > filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*{a
      =^ 'III' && x == '00'}" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y
      | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}" -H "idn,bbg,jahr,tit_a,
      tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed
      '/^209A.*\$x 0[1-8]/d' > filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      | sed '/^209A.*\$x 0[1-8]/d' > filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: b891e381400b45033b7e50b7f763f692
      size: 139676816
    outs:
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: 183eb5137ca02813378e883b179e8cec
      size: 22458
    - path: filter/böm-exemplare.dat
      md5: 40f92116fd06499548141d723216d6ab
      size: 145871
    - path: filter/böm-titel.csv
      md5: dd2809450e8609723ad022a60e5029c7
      size: 130701
    - path: filter/ii-exemplare.dat
      md5: 17914072a1f781a061b4b0a85b1b0880
      size: 10972353
    - path: filter/ii-titel.csv
      md5: e1f8a199346377ac8d24269995006ff5
      size: 107833
    - path: filter/iii-exemplare.dat
      md5: 6c2b3e683639b90d4cf3ef6ffafbbc3d
      size: 5061070
    - path: filter/iii-titel.csv
      md5: f795ad656c4991898170594d0ff23482
      size: 307755
    - path: filter/iv-exemplare.dat
      md5: 72303c898b98f944ad407f5a964ebed8
      size: 4846523
    - path: filter/iv-titel.csv
      md5: 7750c10c1872cded28fc7f762ae29c7d
      size: 1034087
    - path: filter/schreibmeister-exemplare.dat
      md5: a1d21434dc9d1be9c9135e1b0dc87305
      size: 127190
    - path: filter/schreibmeister-titel.csv
      md5: 778e486f747b9aa63a6c9f7d3c50201c
      size: 100206
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: bcfaec1fbec93c98a85820e65ff86457
      size: 38123
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: 183eb5137ca02813378e883b179e8cec
      size: 22458
    - path: filter/böm-exemplare.dat
      md5: 40f92116fd06499548141d723216d6ab
      size: 145871
    - path: filter/böm-titel.csv
      md5: dd2809450e8609723ad022a60e5029c7
      size: 130701
    - path: filter/ii-exemplare.dat
      md5: 17914072a1f781a061b4b0a85b1b0880
      size: 10972353
    - path: filter/ii-titel.csv
      md5: e1f8a199346377ac8d24269995006ff5
      size: 107833
    - path: filter/iii-exemplare.dat
      md5: 6c2b3e683639b90d4cf3ef6ffafbbc3d
      size: 5061070
    - path: filter/iii-titel.csv
      md5: f795ad656c4991898170594d0ff23482
      size: 307755
    - path: filter/iv-exemplare.dat
      md5: 72303c898b98f944ad407f5a964ebed8
      size: 4846523
    - path: filter/iv-titel.csv
      md5: 7750c10c1872cded28fc7f762ae29c7d
      size: 1034087
    - path: filter/schreibmeister-exemplare.dat
      md5: a1d21434dc9d1be9c9135e1b0dc87305
      size: 127190
    - path: filter/schreibmeister-titel.csv
      md5: 778e486f747b9aa63a6c9f7d3c50201c
      size: 100206
    - path: listen_in/böink.xlsx
      md5: 5cdf00f46c13200ab272a419bf6e716e
      size: 87202
    - path: listen_in/böm.xlsx
      md5: d92c9a2ced5ec0eae28418985af5587c
      size: 166318
    - path: listen_in/ii.xlsx
      md5: 7b3d7f449f484dfb8a0ea99f702d80f0
      size: 183139
    - path: listen_in/iii.xlsx
      md5: df03063ccd5ca077ebdbbeb6a0598378
      size: 292925
    - path: listen_in/iv.xlsx
      md5: 05cc2497efeed73640cd6a8f76e0eb63
      size: 794675
    - path: listen_in/schreibmeister.xlsx
      md5: 75cb3408a0884601c9c855bbeb895828
      size: 124295
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: 24ba4e6f577effe78d39f849297cf178
      size: 43580
    - path: abzug/böink.xlsx
      md5: 498fd95b4b3617d33d523b11305b42ba
      size: 30642
    - path: abzug/böm.csv
      md5: f3f0ae0eefdaf94e26e1b1b12c44ecaf
      size: 113021
    - path: abzug/böm.xlsx
      md5: 43f11cf0d353c77943033fb907c911a4
      size: 71474
    - path: abzug/ii.csv
      md5: 86d43d6663dd6704728d4bd0fb901baf
      size: 103712
    - path: abzug/ii.xlsx
      md5: 74954a2e2f24a8af765c3531139252b1
      size: 67965
    - path: abzug/iii.csv
      md5: f947449f34255d1f05f9d0d772674617
      size: 253874
    - path: abzug/iii.xlsx
      md5: 03e6bd82087d900bd0b9eb47d283cf79
      size: 150212
    - path: abzug/iv.csv
      md5: d599536128bf9b60871dcba707eff3af
      size: 882820
    - path: abzug/iv.xlsx
      md5: f4b26501cd514e1b1da1b2113b8b2fdf
      size: 466374
    - path: abzug/schreibmeister.csv
      md5: 69ffbaca58108aee86273bfa4c5ef288
      size: 56499
    - path: abzug/schreibmeister.xlsx
      md5: 81ad3d8dca800294a18a700eb9f831f1
      size: 36512
    - path: listen_out/böink.xlsx
      md5: 2fad88f2e9222e60fc0ab87fb5b4096a
      size: 151629
    - path: listen_out/böm.xlsx
      md5: d3b3dde5bd77f1ef50c693c7529f8b4f
      size: 290909
    - path: listen_out/ii.xlsx
      md5: ced66d436c7d87fa19867e1e12576d2e
      size: 365990
    - path: listen_out/iii.xlsx
      md5: 490ba9f5c8b592cf6a5ba5a916ff4826
      size: 577740
    - path: listen_out/iv.xlsx
      md5: de1a8997c8ec8931dd1cf18922328e3d
      size: 2130243
    - path: listen_out/schreibmeister.xlsx
      md5: 7f9f5336df526dc8c3850a5c6bfa7cbb
      size: 169854
