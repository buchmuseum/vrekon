schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 01283e90af80b4af84f666c567d37e2f
      size: 8196353993
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: b01d57909b5fded68d0a812fbaf14770
      size: 130381443
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'III'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: b01d57909b5fded68d0a812fbaf14770
      size: 130381443
    outs:
    - path: filter/böink-exemplare.dat
      md5: 4044bf0086e5b347c58d824ac81d2431
      size: 48871
    - path: filter/böink-titel.csv
      md5: 396cd9e304f4545dce418a9c7ff3010a
      size: 19497
    - path: filter/böm-exemplare.dat
      md5: d9685c2bbfb11a16e695f387ca31c12c
      size: 131808
    - path: filter/böm-titel.csv
      md5: 25a75a7a4d662c2db49286476f36d452
      size: 126584
    - path: filter/ii-exemplare.dat
      md5: 2aa21026707da4ec444ee5a4dc67b0af
      size: 9499780
    - path: filter/ii-titel.csv
      md5: f21000aab958477d40bb3fee7f77a791
      size: 108617
    - path: filter/iii-exemplare.dat
      md5: 920b00a6bf5f16875c3645dda43aca65
      size: 4049116
    - path: filter/iii-titel.csv
      md5: 3f5c6be719fd15df164c1dbc25163639
      size: 302079
    - path: filter/iv-exemplare.dat
      md5: eb31a55d612a6b9d54b60edeec99b5d1
      size: 4252551
    - path: filter/iv-titel.csv
      md5: e99259d19bea2b179ae4cde9ed8b4eff
      size: 1014722
    - path: filter/schreibmeister-exemplare.dat
      md5: 3356793ab6664384ca3db20efb8c0754
      size: 45132
    - path: filter/schreibmeister-titel.csv
      md5: f91e0bdd6bb11256103c159fc5a3fccb
      size: 48706
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 60cc53719f5e0e2db5dcdf4bc4a26b84
      size: 37090
    - path: filter/böink-exemplare.dat
      md5: 4044bf0086e5b347c58d824ac81d2431
      size: 48871
    - path: filter/böink-titel.csv
      md5: 396cd9e304f4545dce418a9c7ff3010a
      size: 19497
    - path: filter/böm-exemplare.dat
      md5: d9685c2bbfb11a16e695f387ca31c12c
      size: 131808
    - path: filter/böm-titel.csv
      md5: 25a75a7a4d662c2db49286476f36d452
      size: 126584
    - path: filter/ii-exemplare.dat
      md5: 2aa21026707da4ec444ee5a4dc67b0af
      size: 9499780
    - path: filter/ii-titel.csv
      md5: f21000aab958477d40bb3fee7f77a791
      size: 108617
    - path: filter/iii-exemplare.dat
      md5: 920b00a6bf5f16875c3645dda43aca65
      size: 4049116
    - path: filter/iii-titel.csv
      md5: 3f5c6be719fd15df164c1dbc25163639
      size: 302079
    - path: filter/iv-exemplare.dat
      md5: eb31a55d612a6b9d54b60edeec99b5d1
      size: 4252551
    - path: filter/iv-titel.csv
      md5: e99259d19bea2b179ae4cde9ed8b4eff
      size: 1014722
    - path: filter/schreibmeister-exemplare.dat
      md5: 3356793ab6664384ca3db20efb8c0754
      size: 45132
    - path: filter/schreibmeister-titel.csv
      md5: f91e0bdd6bb11256103c159fc5a3fccb
      size: 48706
    - path: listen_in/böink.xlsx
      md5: 6e3ad0d70635f584a0db3b59a1b4a6a0
      size: 71367
    - path: listen_in/böm.xlsx
      md5: a0b179489d7d236c1878986abbefbbf5
      size: 148813
    - path: listen_in/ii.xlsx
      md5: f630a6a36586063288fc242df65c8d1b
      size: 155619
    - path: listen_in/iii.xlsx
      md5: 014740ec475a112a524964bbb2ce58de
      size: 245672
    - path: listen_in/iv.xlsx
      md5: 7c08dbde6fc232239b09eae7f36e68f9
      size: 801839
    - path: listen_in/schreibmeister.xlsx
      md5: ed144db4ed3267645933137cdb638eaf
      size: 114910
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: def723c5cf7121aabc19f5de6406420d
      size: 39527
    - path: abzug/böink.xlsx
      md5: 91b29fa8ab7583303d046ad5fdd209bd
      size: 27759
    - path: abzug/böm.csv
      md5: b5ea945091bfbdeb3494866de14175b6
      size: 108027
    - path: abzug/böm.xlsx
      md5: 04b9931687fc7f593aa8c246609476db
      size: 66923
    - path: abzug/ii.csv
      md5: 258c4a4c1a760ac7120e4873a9473c86
      size: 96278
    - path: abzug/ii.xlsx
      md5: 5b2e0a095463fd51dd965086aade8206
      size: 61389
    - path: abzug/iii.csv
      md5: 41a5c2144ece80d3f6f3584be4e75896
      size: 244341
    - path: abzug/iii.xlsx
      md5: afa22d18c33d28cc369dc32ead50dac6
      size: 141207
    - path: abzug/iv.csv
      md5: 6abb2c17f89f8c3b9c4b720cb889e397
      size: 828428
    - path: abzug/iv.xlsx
      md5: 08735688cb45430cfab3dfa71ce3e17d
      size: 425242
    - path: abzug/schreibmeister.csv
      md5: b5b54b22cec2425d493abaa1a980a2a6
      size: 54314
    - path: abzug/schreibmeister.xlsx
      md5: 2ffd1dcadbe6d198179dd55f0d9381bd
      size: 34634
    - path: listen_out/böink.xlsx
      md5: 3164e1e0132723a56ef0f791d7b77b82
      size: 138903
    - path: listen_out/böm.xlsx
      md5: 0fd983c3fe4186eafc8ce99f7d6c65f9
      size: 276770
    - path: listen_out/ii.xlsx
      md5: 0e4f1da1b250f6e1de0cde405c346c8b
      size: 341293
    - path: listen_out/iii.xlsx
      md5: 7574dbdf29201859a5b25e4dc4cbb46c
      size: 542274
    - path: listen_out/iv.xlsx
      md5: 6f912920b68b30ea128efdb5aa19ed74
      size: 2358792
    - path: listen_out/schreibmeister.xlsx
      md5: 28ba394853f6e26f80d9c4a4b1e6481e
      size: 165637
