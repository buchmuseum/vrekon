schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 815dfbdcb5596f60200decce49b94212
      size: 8396533218
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 0d4b8f5c60367f36c22a5f7ff57a5f5f
      size: 131250622
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --merge
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed '/^209A.*\$x
      0[1-8]/d' > filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*{a
      =^ 'III' && x == '00'}" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y
      | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}" -H "idn,bbg,jahr,tit_a,
      tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed
      '/^209A.*\$x 0[1-8]/d' > filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      | sed '/^209A.*\$x 0[1-8]/d' > filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 0d4b8f5c60367f36c22a5f7ff57a5f5f
      size: 131250622
    outs:
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: f7af143539c6d2e6059fb4bc0ccef18f
      size: 19291
    - path: filter/böm-exemplare.dat
      md5: ce36d9bfac3bd9aa4e6d59c0e99c943e
      size: 145370
    - path: filter/böm-titel.csv
      md5: 9d046bb6040669df8817f813df3e8d9a
      size: 126142
    - path: filter/ii-exemplare.dat
      md5: 6ab3592191c528deeb2bc360d36453d2
      size: 10990636
    - path: filter/ii-titel.csv
      md5: 685aaedce6660c1cbd807d23df953261
      size: 100835
    - path: filter/iii-exemplare.dat
      md5: fde839af9bafac28548dba956c1f501a
      size: 4736370
    - path: filter/iii-titel.csv
      md5: ec86eba12119eac197ac031f331c5035
      size: 298390
    - path: filter/iv-exemplare.dat
      md5: 192ed7256f81da788e8584c22ae9a823
      size: 4860147
    - path: filter/iv-titel.csv
      md5: 1b152639c8de6c32a84dfc4abaf90d6a
      size: 995999
    - path: filter/schreibmeister-exemplare.dat
      md5: a927cc672c7cd5edb05eac7666edd0a5
      size: 48671
    - path: filter/schreibmeister-titel.csv
      md5: 755177c2b5ad0cb3aa8d1e4859b81b2f
      size: 47789
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 844caabc11e0a692c02375e65e0bb9e6
      size: 37846
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: f7af143539c6d2e6059fb4bc0ccef18f
      size: 19291
    - path: filter/böm-exemplare.dat
      md5: ce36d9bfac3bd9aa4e6d59c0e99c943e
      size: 145370
    - path: filter/böm-titel.csv
      md5: 9d046bb6040669df8817f813df3e8d9a
      size: 126142
    - path: filter/ii-exemplare.dat
      md5: 6ab3592191c528deeb2bc360d36453d2
      size: 10990636
    - path: filter/ii-titel.csv
      md5: 685aaedce6660c1cbd807d23df953261
      size: 100835
    - path: filter/iii-exemplare.dat
      md5: fde839af9bafac28548dba956c1f501a
      size: 4736370
    - path: filter/iii-titel.csv
      md5: ec86eba12119eac197ac031f331c5035
      size: 298390
    - path: filter/iv-exemplare.dat
      md5: 192ed7256f81da788e8584c22ae9a823
      size: 4860147
    - path: filter/iv-titel.csv
      md5: 1b152639c8de6c32a84dfc4abaf90d6a
      size: 995999
    - path: filter/schreibmeister-exemplare.dat
      md5: a927cc672c7cd5edb05eac7666edd0a5
      size: 48671
    - path: filter/schreibmeister-titel.csv
      md5: 755177c2b5ad0cb3aa8d1e4859b81b2f
      size: 47789
    - path: listen_in/böink.xlsx
      md5: 58880eb67fb98d0e12863688fe38c588
      size: 71785
    - path: listen_in/böm.xlsx
      md5: e1bfa75386ec6e49f6634215084ce820
      size: 150514
    - path: listen_in/ii.xlsx
      md5: 55766efc4f34154ae67ab26d4dea02ec
      size: 155868
    - path: listen_in/iii.xlsx
      md5: 9651ce8ac646e291e70557330754a9b0
      size: 247836
    - path: listen_in/iv.xlsx
      md5: cecb9e40bc924f325169719253fffb2d
      size: 793947
    - path: listen_in/schreibmeister.xlsx
      md5: c9ca48d483b6243f64dfd82b5cb7fd18
      size: 117307
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: 049378da0cb3e57260cb9988a9afc472
      size: 40536
    - path: abzug/böink.xlsx
      md5: 23a2774ad8fdd1ca53d1711f4c2061b6
      size: 28191
    - path: abzug/böm.csv
      md5: a26189a5c21950cbe82043b747821824
      size: 108396
    - path: abzug/böm.xlsx
      md5: 5925018776f4e5dc707b46c490334207
      size: 67164
    - path: abzug/ii.csv
      md5: 756b8795e55f6fc6e157a56b9ad97cf5
      size: 96369
    - path: abzug/ii.xlsx
      md5: ccf4253cb6a0f2cc09edbcef6f261720
      size: 61467
    - path: abzug/iii.csv
      md5: 8bcbf22561e717680eaeeed346e22868
      size: 244917
    - path: abzug/iii.xlsx
      md5: 80e693a3355389d065161ffd55e1593e
      size: 141744
    - path: abzug/iv.csv
      md5: 9c631428c23db99e6135e5e9daa04067
      size: 837544
    - path: abzug/iv.xlsx
      md5: 2a61dc9c64b37bd01b60e61352609d62
      size: 428392
    - path: abzug/schreibmeister.csv
      md5: 6988277e275db071acf3721951f58c01
      size: 54285
    - path: abzug/schreibmeister.xlsx
      md5: 1da5f5b4ad72263da8c298113702a179
      size: 34618
    - path: listen_out/böink.xlsx
      md5: 2a0674e3637eb1c3c28980cf41f8d20f
      size: 139780
    - path: listen_out/böm.xlsx
      md5: 968b02b300043665ffe3c15833acbe4f
      size: 279316
    - path: listen_out/ii.xlsx
      md5: 7aead5e382776a52c3acabf4f6f72f2f
      size: 343376
    - path: listen_out/iii.xlsx
      md5: 3baaa080d2e62a59a38fd2cff85d1a5d
      size: 547301
    - path: listen_out/iv.xlsx
      md5: 375df3b4d99402cb9bf01ce433e183a3
      size: 2259712
    - path: listen_out/schreibmeister.xlsx
      md5: e4e02cea5156df19addb0840bd9b8438
      size: 167233
