schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 3fcc4f1158c9644590d8d0ba601fe1d6
      size: 9388216094
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 9a185d9a44feda9a50adf7b2b6e4f6b0
      size: 142705050
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --merge
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed '/^209A.*\$x
      0[1-8]/d' > filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*{a
      =^ 'III' && x == '00'}" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y
      | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}" -H "idn,bbg,jahr,tit_a,
      tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed
      '/^209A.*\$x 0[1-8]/d' > filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      | sed '/^209A.*\$x 0[1-8]/d' > filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 9a185d9a44feda9a50adf7b2b6e4f6b0
      size: 142705050
    outs:
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: 29d477dc90c78d2cf3ff654a846d0c6e
      size: 22447
    - path: filter/böm-exemplare.dat
      md5: 955ffa0dedfc828ada0968c06e0db62d
      size: 145905
    - path: filter/böm-titel.csv
      md5: d9e609b63ee80a4109fa39f50a25f515
      size: 130692
    - path: filter/ii-exemplare.dat
      md5: d32c23108b486efef0c0ed6343baa4fc
      size: 10974752
    - path: filter/ii-titel.csv
      md5: 81366af9a81b00045edf4fd0da7746f8
      size: 107939
    - path: filter/iii-exemplare.dat
      md5: 1792040bce4876ec97ac868567fcd939
      size: 5059760
    - path: filter/iii-titel.csv
      md5: 10b5baf6a184e97e10cda16f09256f49
      size: 307737
    - path: filter/iv-exemplare.dat
      md5: bc6ee3e5b1c1bc4c0bc2d202107a76d7
      size: 4863691
    - path: filter/iv-titel.csv
      md5: c854f43aba7005f1f59ee7e8bc666c7e
      size: 1033891
    - path: filter/schreibmeister-exemplare.dat
      md5: f213cea46a1e5d436f0deffdd71c81b1
      size: 129827
    - path: filter/schreibmeister-titel.csv
      md5: 34376041225be9792f245ae6e98e42d7
      size: 99998
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: bcfaec1fbec93c98a85820e65ff86457
      size: 38123
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: 29d477dc90c78d2cf3ff654a846d0c6e
      size: 22447
    - path: filter/böm-exemplare.dat
      md5: 955ffa0dedfc828ada0968c06e0db62d
      size: 145905
    - path: filter/böm-titel.csv
      md5: d9e609b63ee80a4109fa39f50a25f515
      size: 130692
    - path: filter/ii-exemplare.dat
      md5: d32c23108b486efef0c0ed6343baa4fc
      size: 10974752
    - path: filter/ii-titel.csv
      md5: 81366af9a81b00045edf4fd0da7746f8
      size: 107939
    - path: filter/iii-exemplare.dat
      md5: 1792040bce4876ec97ac868567fcd939
      size: 5059760
    - path: filter/iii-titel.csv
      md5: 10b5baf6a184e97e10cda16f09256f49
      size: 307737
    - path: filter/iv-exemplare.dat
      md5: bc6ee3e5b1c1bc4c0bc2d202107a76d7
      size: 4863691
    - path: filter/iv-titel.csv
      md5: c854f43aba7005f1f59ee7e8bc666c7e
      size: 1033891
    - path: filter/schreibmeister-exemplare.dat
      md5: f213cea46a1e5d436f0deffdd71c81b1
      size: 129827
    - path: filter/schreibmeister-titel.csv
      md5: 34376041225be9792f245ae6e98e42d7
      size: 99998
    - path: listen_in/böink.xlsx
      md5: 1c893869241c7c4e28c9905555e99f4e
      size: 87060
    - path: listen_in/böm.xlsx
      md5: 9ff145c90c1c5304f11c37c3447b3550
      size: 167028
    - path: listen_in/ii.xlsx
      md5: abe0089b9730171c8ac3659ffc070f17
      size: 200187
    - path: listen_in/iii.xlsx
      md5: d75a0163128e5beccf579c8415379bee
      size: 293769
    - path: listen_in/iv.xlsx
      md5: 011ac34898c0ff4b334fb01451cac612
      size: 802255
    - path: listen_in/schreibmeister.xlsx
      md5: ef04be97053e0f9b899f7a5493c4a3b7
      size: 123640
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: dc45e9193de059a7a1bd62b1df567c49
      size: 43569
    - path: abzug/böink.xlsx
      md5: 54b67318581e1efa21f307f7b480ceb7
      size: 30635
    - path: abzug/böm.csv
      md5: 856b4ac137b30e39e5a10c26a724c5ee
      size: 113177
    - path: abzug/böm.xlsx
      md5: 96e892d1e6c459a708516108a6c5407e
      size: 71574
    - path: abzug/ii.csv
      md5: 31f00feaeacbed51f99283435946b255
      size: 103808
    - path: abzug/ii.xlsx
      md5: 7b935e5e3a13f52b46a87d96b7a1d6c5
      size: 67993
    - path: abzug/iii.csv
      md5: 5626a33929b8f0ddd5a9884d2b1a396e
      size: 253890
    - path: abzug/iii.xlsx
      md5: fb819f9250b589d65b6b4ae3e847d774
      size: 150200
    - path: abzug/iv.csv
      md5: 87cf9dddd320056e4d726835e1d7a723
      size: 882863
    - path: abzug/iv.xlsx
      md5: 97663360a8a62ccc8c822b60c330fba9
      size: 467146
    - path: abzug/schreibmeister.csv
      md5: 69ffbaca58108aee86273bfa4c5ef288
      size: 56499
    - path: abzug/schreibmeister.xlsx
      md5: efe396029de4677d14537428d6b5f47e
      size: 36512
    - path: listen_out/böink.xlsx
      md5: a9481bbadd40a1615b4656cc99815d5a
      size: 151697
    - path: listen_out/böm.xlsx
      md5: d9cf1aeb3be424258af6b57164279d4b
      size: 291999
    - path: listen_out/ii.xlsx
      md5: 67dcc1976e39f84298e04c060efec84c
      size: 376855
    - path: listen_out/iii.xlsx
      md5: 0cb5dff126479d5300ce476e3575a491
      size: 578519
    - path: listen_out/iv.xlsx
      md5: c7a50814c672b8ec313469956094d8d8
      size: 2132578
    - path: listen_out/schreibmeister.xlsx
      md5: 701920d1b66745bee88bf313e8aefce7
      size: 169927
