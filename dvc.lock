schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 4613a490c961037789d87319d3542019
      size: 7307304292
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 73322727a8ec2da62a95182ec345a964
      size: 124264235
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz
      | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica print
      --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =~ '^II[\\\s\\\d]'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'III'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'IV'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "044P/*.9 == '041799844'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 73322727a8ec2da62a95182ec345a964
      size: 124264235
    outs:
    - path: filter/böink-exemplare.dat
      md5: 27e37093795b7cbe91667685531f667e
      size: 47075
    - path: filter/böink-titel.csv
      md5: c1ca02354fcf8681230d4b395557036a
      size: 19218
    - path: filter/böm-exemplare.dat
      md5: a7f35572ba32c657c60d4afd1640a49d
      size: 173625
    - path: filter/böm-titel.csv
      md5: fc35840eea4f11512f9b2947a6d4e523
      size: 127439
    - path: filter/ii-exemplare.dat
      md5: 6035e5688b38af475f1705e7f3b71217
      size: 9537876
    - path: filter/ii-titel.csv
      md5: 38a4f3e0450d7b9952e1c558128076f4
      size: 114075
    - path: filter/iii-exemplare.dat
      md5: ad1b29e85e5a16a78ba1c3279e6f98c9
      size: 4095529
    - path: filter/iii-titel.csv
      md5: f9aacf2c7fe411be1c217c6d2e831b55
      size: 301288
    - path: filter/iv-exemplare.dat
      md5: 3d09a2a071edd8caef6fd1f403eed2d2
      size: 4709291
    - path: filter/iv-titel.csv
      md5: 893e53abd6c859f93e8197913918c46d
      size: 1004576
    - path: filter/schreibmeister-exemplare.dat
      md5: 78a48bfc022ae9354c4bde2882745525
      size: 37641
    - path: filter/schreibmeister-titel.csv
      md5: bccd9707ba3045d1030ff3fef485c8cc
      size: 40875
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 1de02655b145f2c2777923279bc2a5fc
      size: 1994
    - path: filter/böink-exemplare.dat
      md5: 27e37093795b7cbe91667685531f667e
      size: 47075
    - path: filter/böink-titel.csv
      md5: c1ca02354fcf8681230d4b395557036a
      size: 19218
    - path: filter/böm-exemplare.dat
      md5: a7f35572ba32c657c60d4afd1640a49d
      size: 173625
    - path: filter/böm-titel.csv
      md5: fc35840eea4f11512f9b2947a6d4e523
      size: 127439
    - path: filter/ii-exemplare.dat
      md5: 6035e5688b38af475f1705e7f3b71217
      size: 9537876
    - path: filter/ii-titel.csv
      md5: 38a4f3e0450d7b9952e1c558128076f4
      size: 114075
    - path: filter/iii-exemplare.dat
      md5: ad1b29e85e5a16a78ba1c3279e6f98c9
      size: 4095529
    - path: filter/iii-titel.csv
      md5: f9aacf2c7fe411be1c217c6d2e831b55
      size: 301288
    - path: filter/iv-exemplare.dat
      md5: 3d09a2a071edd8caef6fd1f403eed2d2
      size: 4709291
    - path: filter/iv-titel.csv
      md5: 893e53abd6c859f93e8197913918c46d
      size: 1004576
    - path: filter/schreibmeister-exemplare.dat
      md5: 78a48bfc022ae9354c4bde2882745525
      size: 37641
    - path: filter/schreibmeister-titel.csv
      md5: bccd9707ba3045d1030ff3fef485c8cc
      size: 40875
    - path: listen_in/böink.xlsx
      md5: 92b40208da4b12b1debfeeb277622d4f
      size: 64503
    - path: listen_in/böm.xlsx
      md5: 6655ccf8db2e5d9f6d8cc23746f6d898
      size: 143028
    - path: listen_in/ii.xlsx
      md5: 0ddd45ecc6c9d0bd668df575c765c754
      size: 151817
    - path: listen_in/iii.xlsx
      md5: f8b809816920a05d7d8c0fc026e4b431
      size: 229281
    - path: listen_in/iv.xlsx
      md5: 002764ff65d9e24cc0a13877d819a3c3
      size: 771127
    - path: listen_in/schreibmeister.xlsx
      md5: ca431989379b7831fb7956c2bfd0dd58
      size: 101291
    - path: skripte/abzug.py
      md5: 049fffbda84d22fb1d1bd00994decc7b
      size: 17995
    outs:
    - path: abzug/böink.csv
      md5: 8fc0de7b973cfe20061b05fa31f4f981
      size: 40034
    - path: abzug/böink.xlsx
      md5: 92ebfc761218ad8e9b36f4d50030f861
      size: 27891
    - path: abzug/böm.csv
      md5: 557f32042eab1e9d55c2f5309c1413c1
      size: 108295
    - path: abzug/böm.xlsx
      md5: 6561d8c871e41a099dc12fac031c0130
      size: 67122
    - path: abzug/ii.csv
      md5: 07afd951aeb527ddfedf5ac77d9abbda
      size: 96407
    - path: abzug/ii.xlsx
      md5: 26f497015da0ac4bf3d99e729fc6927a
      size: 61416
    - path: abzug/iii.csv
      md5: 35b3ac9c9ad62b759c305d4ebe20f9b7
      size: 242048
    - path: abzug/iii.xlsx
      md5: 0bcf6243689b46e4a3cb80ce196b78d9
      size: 139098
    - path: abzug/iv.csv
      md5: 15ad8d9b85128557f2dfc90f810e0c2f
      size: 974040
    - path: abzug/iv.xlsx
      md5: a91e5a124dd8f85cd15a0f8a895d17e0
      size: 491288
    - path: abzug/schreibmeister.csv
      md5: 361edd9d583af04078d0a685b49f7b3e
      size: 49896
    - path: abzug/schreibmeister.xlsx
      md5: c82fa8896090ea5a554ae2c15d968b16
      size: 32682
    - path: listen_out/böink.xlsx
      md5: 415176687d45ee5e1f9f39d9da38c449
      size: 123876
    - path: listen_out/böm.xlsx
      md5: 43f6e353167f8b941c68ffc526c4a2da
      size: 255084
    - path: listen_out/ii.xlsx
      md5: bc67c9f318ed70f5eab67ee74ac3460b
      size: 311435
    - path: listen_out/iii.xlsx
      md5: 8be42b2b91a05106c4030e706a4ca337
      size: 488080
    - path: listen_out/iv.xlsx
      md5: 4d319e533d04b816113a0a4d29c974b2
      size: 2183927
    - path: listen_out/schreibmeister.xlsx
      md5: b86fbbed8eed6fdd0c64cd20ad343002
      size: 142222
