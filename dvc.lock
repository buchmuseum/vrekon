schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 04005fd3a5fc26e1c8463fc3e273da04
      size: 9046819930
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: bdf01c39316e11ae487d852e6409cd2c
      size: 138807115
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --merge
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed '/^209A.*\$x
      0[1-8]/d' > filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*{a
      =^ 'III' && x == '00'}" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y
      | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}" -H "idn,bbg,jahr,tit_a,
      tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed
      '/^209A.*\$x 0[1-8]/d' > filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      | sed '/^209A.*\$x 0[1-8]/d' > filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: bdf01c39316e11ae487d852e6409cd2c
      size: 138807115
    outs:
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: 636ccc166a9a60bcf372426749df5adf
      size: 22436
    - path: filter/böm-exemplare.dat
      md5: 40f92116fd06499548141d723216d6ab
      size: 145871
    - path: filter/böm-titel.csv
      md5: 1ddcd8ecb52f02e7c8f508d1eddf2756
      size: 130691
    - path: filter/ii-exemplare.dat
      md5: 02213ca61abeaf64339137fa9345f00e
      size: 10968288
    - path: filter/ii-titel.csv
      md5: d974d40449005ee86ee46cf800285599
      size: 107750
    - path: filter/iii-exemplare.dat
      md5: f6a953f586bf0ddb8d2f776c94a6c3fa
      size: 4975094
    - path: filter/iii-titel.csv
      md5: f404858589e915c33a931e45398d23e0
      size: 307494
    - path: filter/iv-exemplare.dat
      md5: 809ba251fc3ab680efaafcd6554e6dc2
      size: 4844211
    - path: filter/iv-titel.csv
      md5: a27bdd8a936d34dee0b79432bd565c48
      size: 1014241
    - path: filter/schreibmeister-exemplare.dat
      md5: d4dc052d8682a64da9b69f6941f03dcd
      size: 127161
    - path: filter/schreibmeister-titel.csv
      md5: 778e486f747b9aa63a6c9f7d3c50201c
      size: 100206
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 2bfe99d20c1ff36409ada3ab40702b76
      size: 38065
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: 636ccc166a9a60bcf372426749df5adf
      size: 22436
    - path: filter/böm-exemplare.dat
      md5: 40f92116fd06499548141d723216d6ab
      size: 145871
    - path: filter/böm-titel.csv
      md5: 1ddcd8ecb52f02e7c8f508d1eddf2756
      size: 130691
    - path: filter/ii-exemplare.dat
      md5: 02213ca61abeaf64339137fa9345f00e
      size: 10968288
    - path: filter/ii-titel.csv
      md5: d974d40449005ee86ee46cf800285599
      size: 107750
    - path: filter/iii-exemplare.dat
      md5: f6a953f586bf0ddb8d2f776c94a6c3fa
      size: 4975094
    - path: filter/iii-titel.csv
      md5: f404858589e915c33a931e45398d23e0
      size: 307494
    - path: filter/iv-exemplare.dat
      md5: 809ba251fc3ab680efaafcd6554e6dc2
      size: 4844211
    - path: filter/iv-titel.csv
      md5: a27bdd8a936d34dee0b79432bd565c48
      size: 1014241
    - path: filter/schreibmeister-exemplare.dat
      md5: d4dc052d8682a64da9b69f6941f03dcd
      size: 127161
    - path: filter/schreibmeister-titel.csv
      md5: 778e486f747b9aa63a6c9f7d3c50201c
      size: 100206
    - path: listen_in/böink.xlsx
      md5: 927d60219d0b7e7570dcd9ef3cef9c05
      size: 88658
    - path: listen_in/böm.xlsx
      md5: 1832c2f1600083cb3749740bb77e9ecb
      size: 169883
    - path: listen_in/ii.xlsx
      md5: 1edb3c9da6a93d83485a0d182baa6ee0
      size: 185674
    - path: listen_in/iii.xlsx
      md5: bf7357879ee7f2ac5312aa5bd413a67e
      size: 294583
    - path: listen_in/iv.xlsx
      md5: 031e905b936482942d93aec4d58406c3
      size: 775194
    - path: listen_in/schreibmeister.xlsx
      md5: 84602d973233e0d92b828ddb1e3e25b6
      size: 125160
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: 24ba4e6f577effe78d39f849297cf178
      size: 43580
    - path: abzug/böink.xlsx
      md5: 2807c384852117fef13c0f206402c432
      size: 30642
    - path: abzug/böm.csv
      md5: f3f0ae0eefdaf94e26e1b1b12c44ecaf
      size: 113021
    - path: abzug/böm.xlsx
      md5: abcb476136b3c8fce59024310f77070a
      size: 71475
    - path: abzug/ii.csv
      md5: 86d43d6663dd6704728d4bd0fb901baf
      size: 103712
    - path: abzug/ii.xlsx
      md5: ce7947c401d733f9bbf1f67195108cae
      size: 67965
    - path: abzug/iii.csv
      md5: f947449f34255d1f05f9d0d772674617
      size: 253874
    - path: abzug/iii.xlsx
      md5: 0290a9c7f919d190e84d43d6b691e56e
      size: 150212
    - path: abzug/iv.csv
      md5: 197c142871dc5533e11bc55b9b02012d
      size: 862424
    - path: abzug/iv.xlsx
      md5: c1f8436f0cfd99f52dc69d323173b57c
      size: 447755
    - path: abzug/schreibmeister.csv
      md5: 69ffbaca58108aee86273bfa4c5ef288
      size: 56499
    - path: abzug/schreibmeister.xlsx
      md5: aef01ef1cfee0c44d78c780820f94742
      size: 36513
    - path: listen_out/böink.xlsx
      md5: db024de8c3348bbe59129708789a7286
      size: 151307
    - path: listen_out/böm.xlsx
      md5: 31901b0140673ad83cdfbb5773bb3a89
      size: 290526
    - path: listen_out/ii.xlsx
      md5: b7b04e42f195613dcd1daff3c0162bc6
      size: 364129
    - path: listen_out/iii.xlsx
      md5: b0b0360dfb6ff6c477e4be40145d2f57
      size: 576398
    - path: listen_out/iv.xlsx
      md5: c80b8305a276cf2bbf3f7b1b9431058e
      size: 2112056
    - path: listen_out/schreibmeister.xlsx
      md5: c95380bd4f4e94514e941933ef1041eb
      size: 169952
