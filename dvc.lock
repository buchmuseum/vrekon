schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: d41190667b6886d47ebf1d44471dbd03
      size: 7540172913
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 43797e4f5b114984d0b96eace5eaa444
      size: 125509559
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz
      | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica print
      --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =~ '^II[\\\s\\\d]'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'III'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'IV'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "044P/*.9 == '041799844'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 43797e4f5b114984d0b96eace5eaa444
      size: 125509559
    outs:
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: e2f4100b10dca7aaf0ae0321acad3df5
      size: 19208
    - path: filter/böm-exemplare.dat
      md5: ee4583a265a28d2989b54259de6fe02a
      size: 131675
    - path: filter/böm-titel.csv
      md5: a74557082d0dda1a71a6dd1470696000
      size: 126580
    - path: filter/ii-exemplare.dat
      md5: b6c7773a473fcb839e4a4831e6309c5e
      size: 9452654
    - path: filter/ii-titel.csv
      md5: 42686b32e50d48146698268593fa3ce0
      size: 108248
    - path: filter/iii-exemplare.dat
      md5: 67b51b5860d5625f97312dd6255fcc2b
      size: 4009638
    - path: filter/iii-titel.csv
      md5: 2d78b88f4effed6ab446f9855d2a2699
      size: 300687
    - path: filter/iv-exemplare.dat
      md5: db232827a5f3fd11011d503226b069b9
      size: 4195057
    - path: filter/iv-titel.csv
      md5: bf4420191d4261896f8e09faa107ff76
      size: 1015848
    - path: filter/schreibmeister-exemplare.dat
      md5: 581b9f057758b4d2c0c02c93cf28e0aa
      size: 41714
    - path: filter/schreibmeister-titel.csv
      md5: 309bceaf1803d11bffd2563d8de3aead
      size: 46209
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 521d4e0e8235cdf55b7762cbb2ee3608
      size: 4000
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: e2f4100b10dca7aaf0ae0321acad3df5
      size: 19208
    - path: filter/böm-exemplare.dat
      md5: ee4583a265a28d2989b54259de6fe02a
      size: 131675
    - path: filter/böm-titel.csv
      md5: a74557082d0dda1a71a6dd1470696000
      size: 126580
    - path: filter/ii-exemplare.dat
      md5: b6c7773a473fcb839e4a4831e6309c5e
      size: 9452654
    - path: filter/ii-titel.csv
      md5: 42686b32e50d48146698268593fa3ce0
      size: 108248
    - path: filter/iii-exemplare.dat
      md5: 67b51b5860d5625f97312dd6255fcc2b
      size: 4009638
    - path: filter/iii-titel.csv
      md5: 2d78b88f4effed6ab446f9855d2a2699
      size: 300687
    - path: filter/iv-exemplare.dat
      md5: db232827a5f3fd11011d503226b069b9
      size: 4195057
    - path: filter/iv-titel.csv
      md5: bf4420191d4261896f8e09faa107ff76
      size: 1015848
    - path: filter/schreibmeister-exemplare.dat
      md5: 581b9f057758b4d2c0c02c93cf28e0aa
      size: 41714
    - path: filter/schreibmeister-titel.csv
      md5: 309bceaf1803d11bffd2563d8de3aead
      size: 46209
    - path: listen_in/böink.xlsx
      md5: 157493909ff980a9fa3f27f654dc0f7a
      size: 72174
    - path: listen_in/böm.xlsx
      md5: 3b14cf1acc1534d7e1120750c243d333
      size: 150248
    - path: listen_in/ii.xlsx
      md5: d028e09532e3e4e7716ce2786033ac90
      size: 157724
    - path: listen_in/iii.xlsx
      md5: 8593f29badca5489e16681d0c6a49642
      size: 240972
    - path: listen_in/iv.xlsx
      md5: 7745e264b0ae00465fc642ce34d9d3a2
      size: 868762
    - path: listen_in/schreibmeister.xlsx
      md5: 7ffb037f0ee18263da66e6ca5a95510b
      size: 109987
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: c631b01361dabf61c4b3b968f7220520
      size: 40377
    - path: abzug/böink.xlsx
      md5: cb8ef9f178f7d7437c36c5a91cc003c4
      size: 28061
    - path: abzug/böm.csv
      md5: 371ed7dcb44fb25cbf6f3673e0c25d02
      size: 108117
    - path: abzug/böm.xlsx
      md5: ed379a40d5d51d349b3f9364c8ab58e7
      size: 66888
    - path: abzug/ii.csv
      md5: 8b0ad8a90d70fcf62b4c39d0293f37d9
      size: 96218
    - path: abzug/ii.xlsx
      md5: 5a98c6b4fa8e99e58d67855861403723
      size: 61365
    - path: abzug/iii.csv
      md5: f3098e1a8ae8118736056be1007127b8
      size: 243280
    - path: abzug/iii.xlsx
      md5: f68f3fd09752e9e09d5726747bfc290d
      size: 139999
    - path: abzug/iv.csv
      md5: cc71d77bd477858835fd008c9658ca8f
      size: 1008415
    - path: abzug/iv.xlsx
      md5: 77f12278faef1b33e436aaca3c74bfbf
      size: 506722
    - path: abzug/schreibmeister.csv
      md5: 7fb7dc7597e17ab2ca1ff96371084ef8
      size: 54763
    - path: abzug/schreibmeister.xlsx
      md5: 72602ede29143c0928aa507bd9231a01
      size: 34952
    - path: listen_out/böink.xlsx
      md5: cd41ab6d24db563cf83fc5624092e5b5
      size: 139237
    - path: listen_out/böm.xlsx
      md5: 9995ce30f6f16ca27e5771db1f8898ce
      size: 277792
    - path: listen_out/ii.xlsx
      md5: c608f472e67a52f149f8cf0103f56647
      size: 345755
    - path: listen_out/iii.xlsx
      md5: 4253db3de4994aa55fc70a5189c4968e
      size: 542518
    - path: listen_out/iv.xlsx
      md5: 2edfda3116f80bd1f4dd00d545a81173
      size: 2492661
    - path: listen_out/schreibmeister.xlsx
      md5: 723642a43dd607e9b8347a932989696f
      size: 160984
