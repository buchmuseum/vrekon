schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: b6c051df951e5a63833ce82768312198
      size: 7237694653
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 969e66bc61e6731d738f291d9cf35412
      size: 123658229
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz
      | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica print
      --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =^ 'II '" dump/dbsm-titel-exemplare.dat.gz | pica select
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'II '"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III'" dump/dbsm-titel-exemplare.dat.gz | pica select
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'III'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica select
      --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'IV'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4243,f4256,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "044P/*.9 == '041799844'
      && 011@.a =~ '^([01xX][0-7xX][0-9xX][0-9xX])|([01xX][8][12][0-9xX])|([01xX][8][3][0])'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 969e66bc61e6731d738f291d9cf35412
      size: 123658229
    outs:
    - path: filter/böink-exemplare.dat
      md5: 5349bfe5e6ca5f14cfea73c544d28333
      size: 45926
    - path: filter/böink-titel.csv
      md5: 974f19582c2bb7ce31165a7b2ad883c0
      size: 19067
    - path: filter/böm-exemplare.dat
      md5: 0a6f866e8607d295bc289c624e561a7c
      size: 208561
    - path: filter/böm-titel.csv
      md5: 25b4e942447fab992243d0661b1ac329
      size: 127536
    - path: filter/ii-exemplare.dat
      md5: 359ed12a5a20353c0c768c32b105526d
      size: 9373417
    - path: filter/ii-titel.csv
      md5: eac58be99374c5ac26c0b1deb1a9a0dd
      size: 112517
    - path: filter/iii-exemplare.dat
      md5: 2a0527a72050e51ed431cbcd25fbafd0
      size: 4071760
    - path: filter/iii-titel.csv
      md5: bb03566cdd94ed0f35118796f3febd6b
      size: 301311
    - path: filter/iv-exemplare.dat
      md5: a06297904acd75d8d958ab4d3f6fa88f
      size: 4946692
    - path: filter/iv-titel.csv
      md5: f275f399db51ce36793adf0f99686a99
      size: 1001138
    - path: filter/schreibmeister-exemplare.dat
      md5: a590b886abf26822dc6f3cca93b1a2ee
      size: 32532
    - path: filter/schreibmeister-titel.csv
      md5: 6862a6c491f090c62d6e36df2cb1b57b
      size: 40875
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 07fd2c70c1b7a6a2021e75a23410a2fe
      size: 1755
    - path: filter/böink-exemplare.dat
      md5: 5349bfe5e6ca5f14cfea73c544d28333
      size: 45926
    - path: filter/böink-titel.csv
      md5: 974f19582c2bb7ce31165a7b2ad883c0
      size: 19067
    - path: filter/böm-exemplare.dat
      md5: 0a6f866e8607d295bc289c624e561a7c
      size: 208561
    - path: filter/böm-titel.csv
      md5: 25b4e942447fab992243d0661b1ac329
      size: 127536
    - path: filter/ii-exemplare.dat
      md5: 359ed12a5a20353c0c768c32b105526d
      size: 9373417
    - path: filter/ii-titel.csv
      md5: eac58be99374c5ac26c0b1deb1a9a0dd
      size: 112517
    - path: filter/iii-exemplare.dat
      md5: 2a0527a72050e51ed431cbcd25fbafd0
      size: 4071760
    - path: filter/iii-titel.csv
      md5: bb03566cdd94ed0f35118796f3febd6b
      size: 301311
    - path: filter/iv-exemplare.dat
      md5: a06297904acd75d8d958ab4d3f6fa88f
      size: 4946692
    - path: filter/iv-titel.csv
      md5: f275f399db51ce36793adf0f99686a99
      size: 1001138
    - path: filter/schreibmeister-exemplare.dat
      md5: a590b886abf26822dc6f3cca93b1a2ee
      size: 32532
    - path: filter/schreibmeister-titel.csv
      md5: 6862a6c491f090c62d6e36df2cb1b57b
      size: 40875
    - path: skripte/abzug.py
      md5: f66ed16801d9c3443a4440ed34c087c2
      size: 17204
    outs:
    - path: abzug/böink.csv
      md5: 20acf3c8ef286352b9bf73767eabb5d4
      size: 39536
    - path: abzug/böink.xlsx
      md5: 9ee27ec77de908e2d827ee6618ca4dd9
      size: 27187
    - path: abzug/böm.csv
      md5: d002343d7c427ad81ea955203608632f
      size: 108884
    - path: abzug/böm.xlsx
      md5: 4d8e12c7f4933d3a9a7ebd83278f2157
      size: 66525
    - path: abzug/ii.csv
      md5: ce7bddc7bfbf1fea7b9ebf3e78c42f15
      size: 93237
    - path: abzug/ii.xlsx
      md5: 428198aca8c9c5b3ecaad9e130250aaf
      size: 58274
    - path: abzug/iii.csv
      md5: da50d1e7deaef7bb82f50a26e5dd1c9f
      size: 245061
    - path: abzug/iii.xlsx
      md5: 890a3e4ccb9301718dfc719a24952b1c
      size: 138118
    - path: abzug/iv.csv
      md5: f3ee369049e840c9744723bcea3142f4
      size: 844395
    - path: abzug/iv.xlsx
      md5: 13d08a49b7d738e5d7eed35b1d455d79
      size: 441573
    - path: abzug/schreibmeister.csv
      md5: c706a4ed1eecd8ada78488e366c0d5d0
      size: 47897
    - path: abzug/schreibmeister.xlsx
      md5: 22fc028d2afcccf6548976f0899a3a0d
      size: 32237
