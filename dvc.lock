schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 52c56cfcce99e2587f34c0744b479d34
      size: 7457308513
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: c13991ea000e18de96876b7278ae7433
      size: 125141660
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz
      | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica print
      --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =~ '^II[\\\s\\\d]'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'III'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'IV'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "044P/*.9 == '041799844'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: c13991ea000e18de96876b7278ae7433
      size: 125141660
    outs:
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: c1ca02354fcf8681230d4b395557036a
      size: 19218
    - path: filter/böm-exemplare.dat
      md5: 5c46f2c2f44bf87c26e3126923c89f40
      size: 131513
    - path: filter/böm-titel.csv
      md5: 2091bcd16dc9a2badad5723303e62ddd
      size: 126818
    - path: filter/ii-exemplare.dat
      md5: cc4a17830715c3901a23d3174f26ca3a
      size: 9559503
    - path: filter/ii-titel.csv
      md5: aeb28b0db7a7950275c6f5990ca29195
      size: 108355
    - path: filter/iii-exemplare.dat
      md5: b1d38cbb56c522b0a08aa7e25a098edd
      size: 4110721
    - path: filter/iii-titel.csv
      md5: 82831a34b988945b2d27353a962b8fdb
      size: 300814
    - path: filter/iv-exemplare.dat
      md5: b4e7aded54840b5bae08bf34fb220dd3
      size: 4197070
    - path: filter/iv-titel.csv
      md5: 7154389d8784ba6bf5cae093542a3eec
      size: 1015674
    - path: filter/schreibmeister-exemplare.dat
      md5: 3552458a25b2b56ea8babe1257a1afe7
      size: 39019
    - path: filter/schreibmeister-titel.csv
      md5: bccd9707ba3045d1030ff3fef485c8cc
      size: 40875
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 0ced5847dcbcc08bd5531f40978ad31b
      size: 3565
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: c1ca02354fcf8681230d4b395557036a
      size: 19218
    - path: filter/böm-exemplare.dat
      md5: 5c46f2c2f44bf87c26e3126923c89f40
      size: 131513
    - path: filter/böm-titel.csv
      md5: 2091bcd16dc9a2badad5723303e62ddd
      size: 126818
    - path: filter/ii-exemplare.dat
      md5: cc4a17830715c3901a23d3174f26ca3a
      size: 9559503
    - path: filter/ii-titel.csv
      md5: aeb28b0db7a7950275c6f5990ca29195
      size: 108355
    - path: filter/iii-exemplare.dat
      md5: b1d38cbb56c522b0a08aa7e25a098edd
      size: 4110721
    - path: filter/iii-titel.csv
      md5: 82831a34b988945b2d27353a962b8fdb
      size: 300814
    - path: filter/iv-exemplare.dat
      md5: b4e7aded54840b5bae08bf34fb220dd3
      size: 4197070
    - path: filter/iv-titel.csv
      md5: 7154389d8784ba6bf5cae093542a3eec
      size: 1015674
    - path: filter/schreibmeister-exemplare.dat
      md5: 3552458a25b2b56ea8babe1257a1afe7
      size: 39019
    - path: filter/schreibmeister-titel.csv
      md5: bccd9707ba3045d1030ff3fef485c8cc
      size: 40875
    - path: listen_in/böink.xlsx
      md5: a6b13baf5db3473baf2590bd42e83881
      size: 123876
    - path: listen_in/böm.xlsx
      md5: 46cb8ac9b9b0673cff5fb76caae52246
      size: 255084
    - path: listen_in/ii.xlsx
      md5: 553e5875b68ba5e133676dce8e15aec1
      size: 311435
    - path: listen_in/iii.xlsx
      md5: 1dddd3048e613a533f781dcec62b1f44
      size: 488080
    - path: listen_in/iv.xlsx
      md5: eba10b114a9fc8363ed25af1d0aab7f7
      size: 818137
    - path: listen_in/schreibmeister.xlsx
      md5: 615fa2b142564c922bcc25968fec3d77
      size: 142222
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: 87c822371a90fa3acadeaf3304873ee7
      size: 40249
    - path: abzug/böink.xlsx
      md5: 6c17af89f0539f4e2e8f2208daacfa72
      size: 28019
    - path: abzug/böm.csv
      md5: 99f490139ff0c45bbea9604bda5d1dc6
      size: 107644
    - path: abzug/böm.xlsx
      md5: 42bdba5b80fdc4ffd6041d8484c63f40
      size: 66588
    - path: abzug/ii.csv
      md5: 79e7b742b927f1bb0b6c10566122a321
      size: 97254
    - path: abzug/ii.xlsx
      md5: df9029b63902baa44a75a401f6ea26e6
      size: 61867
    - path: abzug/iii.csv
      md5: 26cefc782ffe0d3affd795a683258065
      size: 243356
    - path: abzug/iii.xlsx
      md5: 49a09e80e6a8c1cef3e5cfe4b5640cbf
      size: 139898
    - path: abzug/iv.csv
      md5: 9e9ca46ac6f3e3b618ae674cdd5cc4b5
      size: 1006233
    - path: abzug/iv.xlsx
      md5: f135fbe125718f8251931910bd540864
      size: 505290
    - path: abzug/schreibmeister.csv
      md5: d7e27469983230084aa118aae7c760d6
      size: 50137
    - path: abzug/schreibmeister.xlsx
      md5: 72bce8a64c818334a050d8e76d1a2136
      size: 32839
    - path: listen_out/böink.xlsx
      md5: 39f45260b8576e76a891916ce9d3158f
      size: 123959
    - path: listen_out/böm.xlsx
      md5: f31507c4af06e656165d49bea7b26cbf
      size: 255212
    - path: listen_out/ii.xlsx
      md5: 193a98e7f5b6446d238791bce71c15e6
      size: 313455
    - path: listen_out/iii.xlsx
      md5: d0403c26d85e396b12d0c372707faa57
      size: 489255
    - path: listen_out/iv.xlsx
      md5: 204b34331354b2f3b26c187db9a07c3b
      size: 2247508
    - path: listen_out/schreibmeister.xlsx
      md5: c11823d16a661cc74fdad5d1b77bff40
      size: 142297
