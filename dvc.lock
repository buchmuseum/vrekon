schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: fdab04b9ecda6f1852a7de99b8390b96
      size: 8497508379
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 3f43b678ea998ed6a816404e3107c895
      size: 133024606
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --merge
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed '/^209A.*\$x
      0[1-8]/d' > filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*{a
      =^ 'III' && x == '00'}" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y
      | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}" -H "idn,bbg,jahr,tit_a,
      tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed
      '/^209A.*\$x 0[1-8]/d' > filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      | sed '/^209A.*\$x 0[1-8]/d' > filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 3f43b678ea998ed6a816404e3107c895
      size: 133024606
    outs:
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: f7af143539c6d2e6059fb4bc0ccef18f
      size: 19291
    - path: filter/böm-exemplare.dat
      md5: ce36d9bfac3bd9aa4e6d59c0e99c943e
      size: 145370
    - path: filter/böm-titel.csv
      md5: 9a347ea8adbdcf64ae4146971405a1f4
      size: 126184
    - path: filter/ii-exemplare.dat
      md5: 5d7afd43e0c3335417dda58048c3bfe1
      size: 10994035
    - path: filter/ii-titel.csv
      md5: 685aaedce6660c1cbd807d23df953261
      size: 100835
    - path: filter/iii-exemplare.dat
      md5: e9a0ed95b35c2bdbe758239dc3a85c6c
      size: 4737414
    - path: filter/iii-titel.csv
      md5: 6afdba346b7b21abef2f3c8979cab446
      size: 301346
    - path: filter/iv-exemplare.dat
      md5: 4b3b304868dd8535b843e3aea1df3ef2
      size: 4883282
    - path: filter/iv-titel.csv
      md5: 8805c4dd9e222b09ee3c09e5dfb6c8c1
      size: 996823
    - path: filter/schreibmeister-exemplare.dat
      md5: 1107d8b67970e68309925f36c99ec0dd
      size: 48638
    - path: filter/schreibmeister-titel.csv
      md5: b28124181b911371ed205b34facfc300
      size: 48316
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 7d2c9965bf45566c75e92889864b6528
      size: 37918
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: f7af143539c6d2e6059fb4bc0ccef18f
      size: 19291
    - path: filter/böm-exemplare.dat
      md5: ce36d9bfac3bd9aa4e6d59c0e99c943e
      size: 145370
    - path: filter/böm-titel.csv
      md5: 9a347ea8adbdcf64ae4146971405a1f4
      size: 126184
    - path: filter/ii-exemplare.dat
      md5: 5d7afd43e0c3335417dda58048c3bfe1
      size: 10994035
    - path: filter/ii-titel.csv
      md5: 685aaedce6660c1cbd807d23df953261
      size: 100835
    - path: filter/iii-exemplare.dat
      md5: e9a0ed95b35c2bdbe758239dc3a85c6c
      size: 4737414
    - path: filter/iii-titel.csv
      md5: 6afdba346b7b21abef2f3c8979cab446
      size: 301346
    - path: filter/iv-exemplare.dat
      md5: 4b3b304868dd8535b843e3aea1df3ef2
      size: 4883282
    - path: filter/iv-titel.csv
      md5: 8805c4dd9e222b09ee3c09e5dfb6c8c1
      size: 996823
    - path: filter/schreibmeister-exemplare.dat
      md5: 1107d8b67970e68309925f36c99ec0dd
      size: 48638
    - path: filter/schreibmeister-titel.csv
      md5: b28124181b911371ed205b34facfc300
      size: 48316
    - path: listen_in/böink.xlsx
      md5: a8755a9203c919cd5c30413630e72cb3
      size: 73046
    - path: listen_in/böm.xlsx
      md5: 762f2179a8e829043d58286ac795cd37
      size: 151836
    - path: listen_in/ii.xlsx
      md5: ff5dfa49e3740a3e1057eb26c0a7c873
      size: 158852
    - path: listen_in/iii.xlsx
      md5: 8264a6bcd46321bf78e2d59843cc2eaf
      size: 265887
    - path: listen_in/iv.xlsx
      md5: cd06253111e67fccc6f7b65e8675dffa
      size: 762661
    - path: listen_in/schreibmeister.xlsx
      md5: e585ef92174e3d34004714a70d708757
      size: 119850
    - path: skripte/abzug.py
      md5: fe8cb2f592dcc173e6ad4e2eacda124b
      size: 17748
    outs:
    - path: abzug/böink.csv
      md5: cb50aa2f6dee9207edc75581cca903e5
      size: 41694
    - path: abzug/böink.xlsx
      md5: 7955bb7981cc9c7786734a60008698b0
      size: 29045
    - path: abzug/böm.csv
      md5: d3c1310c767d0c73a4d6c7eefd7ee471
      size: 110168
    - path: abzug/böm.xlsx
      md5: f9360f098313243fe42d1680348313eb
      size: 68389
    - path: abzug/ii.csv
      md5: 83e4f3482fcbaa4df69d2602daae0999
      size: 98049
    - path: abzug/ii.xlsx
      md5: ec3c1fa09d72b437ef05b1271d584f6f
      size: 62584
    - path: abzug/iii.csv
      md5: 9cd74699f0e6056805eb7b4927b7d953
      size: 253918
    - path: abzug/iii.xlsx
      md5: b6eb68cf6d1d0cd0b7a9653cfa6013bf
      size: 147601
    - path: abzug/iv.csv
      md5: 77df986667b92cc993bd0cc0429d26c7
      size: 843707
    - path: abzug/iv.xlsx
      md5: dbd730a6405383660946bbc04bb67739
      size: 431946
    - path: abzug/schreibmeister.csv
      md5: 00aff2795a9598b338890bb01b497aba
      size: 54281
    - path: abzug/schreibmeister.xlsx
      md5: 6fcc0d089a13c66eddfbdc9a39c08290
      size: 34618
    - path: listen_out/böink.xlsx
      md5: 3c72427c6fd18df6543cfcaaa22ee17d
      size: 143742
    - path: listen_out/böm.xlsx
      md5: f3f8118f7196fd53a577536ae7e344a2
      size: 284365
    - path: listen_out/ii.xlsx
      md5: efe114c53bd9ec224db02a960d92ac0f
      size: 351039
    - path: listen_out/iii.xlsx
      md5: b5779f8a7f8e14c153b271f0cc0dd47d
      size: 565824
    - path: listen_out/iv.xlsx
      md5: 4efcfc6cb348eb8edf0494ada1f4a3ce
      size: 2087599
    - path: listen_out/schreibmeister.xlsx
      md5: 7c5e0b2d8bf16e72dd0a151d8b0b7b25
      size: 167489
