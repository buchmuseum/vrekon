schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: be6a804592559f196319249a1466928f
      size: 7614212278
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 98d25357a08316e5d75ba55a61793d48
      size: 126733368
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz
      | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica print
      --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =~ '^II[\\\s\\\d]'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'III'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'IV'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "044P/*.9 == '041799844'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 98d25357a08316e5d75ba55a61793d48
      size: 126733368
    outs:
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: e2f4100b10dca7aaf0ae0321acad3df5
      size: 19208
    - path: filter/böm-exemplare.dat
      md5: d1de1e590b611118c40382b0087f7797
      size: 131735
    - path: filter/böm-titel.csv
      md5: a74557082d0dda1a71a6dd1470696000
      size: 126580
    - path: filter/ii-exemplare.dat
      md5: 3d37c8415be8e11a3920897236b22a9b
      size: 9456870
    - path: filter/ii-titel.csv
      md5: 42686b32e50d48146698268593fa3ce0
      size: 108248
    - path: filter/iii-exemplare.dat
      md5: fcfd1052cc09e7b28f072fabde0938eb
      size: 4012474
    - path: filter/iii-titel.csv
      md5: ca1eddeb39069b76a63d58dabbfd4473
      size: 300750
    - path: filter/iv-exemplare.dat
      md5: 373ac5fad4e847baac3c121a26ae791c
      size: 4217312
    - path: filter/iv-titel.csv
      md5: d1c6133c9ef85e81ed7f022bbe7ebd89
      size: 1016354
    - path: filter/schreibmeister-exemplare.dat
      md5: 15b9aaff4a2bb8b82ce3e16cea5883ac
      size: 41753
    - path: filter/schreibmeister-titel.csv
      md5: d11930310606b8952c03f39de8e402a5
      size: 46221
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 65a21fd7dc69f1b42f9dbefeaee02de1
      size: 37187
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: e2f4100b10dca7aaf0ae0321acad3df5
      size: 19208
    - path: filter/böm-exemplare.dat
      md5: d1de1e590b611118c40382b0087f7797
      size: 131735
    - path: filter/böm-titel.csv
      md5: a74557082d0dda1a71a6dd1470696000
      size: 126580
    - path: filter/ii-exemplare.dat
      md5: 3d37c8415be8e11a3920897236b22a9b
      size: 9456870
    - path: filter/ii-titel.csv
      md5: 42686b32e50d48146698268593fa3ce0
      size: 108248
    - path: filter/iii-exemplare.dat
      md5: fcfd1052cc09e7b28f072fabde0938eb
      size: 4012474
    - path: filter/iii-titel.csv
      md5: ca1eddeb39069b76a63d58dabbfd4473
      size: 300750
    - path: filter/iv-exemplare.dat
      md5: 373ac5fad4e847baac3c121a26ae791c
      size: 4217312
    - path: filter/iv-titel.csv
      md5: d1c6133c9ef85e81ed7f022bbe7ebd89
      size: 1016354
    - path: filter/schreibmeister-exemplare.dat
      md5: 15b9aaff4a2bb8b82ce3e16cea5883ac
      size: 41753
    - path: filter/schreibmeister-titel.csv
      md5: d11930310606b8952c03f39de8e402a5
      size: 46221
    - path: listen_in/böink.xlsx
      md5: bc8a087c97ef6d4cfaf1738ab601177d
      size: 73135
    - path: listen_in/böm.xlsx
      md5: f63e0e36ca4cf47cb046472871ebf15b
      size: 149700
    - path: listen_in/ii.xlsx
      md5: 3aec5a4bd41e77eac34ec9a1dfc65564
      size: 156122
    - path: listen_in/iii.xlsx
      md5: 10d43cfbdf9c5f19c34f8243a8186a56
      size: 240220
    - path: listen_in/iv.xlsx
      md5: 9a7ba8b1c3358d11f39cf0963b07c1bd
      size: 808084
    - path: listen_in/schreibmeister.xlsx
      md5: 59eb24bae79605878f33ced07b55ab3e
      size: 110591
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: c631b01361dabf61c4b3b968f7220520
      size: 40377
    - path: abzug/böink.xlsx
      md5: 89a8e6bc62cd9f1cf50083742311152f
      size: 28061
    - path: abzug/böm.csv
      md5: 371ed7dcb44fb25cbf6f3673e0c25d02
      size: 108117
    - path: abzug/böm.xlsx
      md5: 19c3c4a3146d1e3f7f75834db4741037
      size: 66888
    - path: abzug/ii.csv
      md5: 8b0ad8a90d70fcf62b4c39d0293f37d9
      size: 96218
    - path: abzug/ii.xlsx
      md5: bcb762a0714e44a896d35d7fd484ac48
      size: 61366
    - path: abzug/iii.csv
      md5: fc79128005abdbc4e5bcdfb1efa06256
      size: 243279
    - path: abzug/iii.xlsx
      md5: f0372a23c369ed3e8f1a9a224b3d2cab
      size: 139995
    - path: abzug/iv.csv
      md5: bc484a0c53db2510b034a0ad69c75b43
      size: 824864
    - path: abzug/iv.xlsx
      md5: 5b4ddb6bdbea7d6c37abc5a91ef44efc
      size: 424197
    - path: abzug/schreibmeister.csv
      md5: 345b1890ac1151ce9a8184e9c74ab9dd
      size: 51876
    - path: abzug/schreibmeister.xlsx
      md5: 9af735ca279562cc2422b9ae4fe05c89
      size: 33287
    - path: listen_out/böink.xlsx
      md5: 474d0a7b45e60a1477718c659f917f9b
      size: 138843
    - path: listen_out/böm.xlsx
      md5: 834e1a25b1e57b6b410bedf29c8234aa
      size: 277921
    - path: listen_out/ii.xlsx
      md5: c1cc99cba40dda59279c07609aafcdd5
      size: 342969
    - path: listen_out/iii.xlsx
      md5: 0fa4120b2c7ca6abb6c1508f782f0ae1
      size: 542100
    - path: listen_out/iv.xlsx
      md5: 5c5bcff9962d28582e09aefaafbdac25
      size: 2368085
    - path: listen_out/schreibmeister.xlsx
      md5: 971abbb1b8d60965a680236bed05f4a9
      size: 159501
