schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: fdab04b9ecda6f1852a7de99b8390b96
      size: 8497508379
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 3f43b678ea998ed6a816404e3107c895
      size: 133024606
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --merge
      --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed '/^209A.*\$x
      0[1-8]/d' > filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*{a
      =^ 'III' && x == '00'}" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc | sed '/^209A.*\$x 0[1-8]/d' > filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y
      | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}" -H "idn,bbg,jahr,tit_a,
      tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc | sed
      '/^209A.*\$x 0[1-8]/d' > filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --merge --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y | Y?},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      | sed '/^209A.*\$x 0[1-8]/d' > filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 3f43b678ea998ed6a816404e3107c895
      size: 133024606
    outs:
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: f7af143539c6d2e6059fb4bc0ccef18f
      size: 19291
    - path: filter/böm-exemplare.dat
      md5: ce36d9bfac3bd9aa4e6d59c0e99c943e
      size: 145370
    - path: filter/böm-titel.csv
      md5: 9a347ea8adbdcf64ae4146971405a1f4
      size: 126184
    - path: filter/ii-exemplare.dat
      md5: 5d7afd43e0c3335417dda58048c3bfe1
      size: 10994035
    - path: filter/ii-titel.csv
      md5: 685aaedce6660c1cbd807d23df953261
      size: 100835
    - path: filter/iii-exemplare.dat
      md5: e9a0ed95b35c2bdbe758239dc3a85c6c
      size: 4737414
    - path: filter/iii-titel.csv
      md5: 6afdba346b7b21abef2f3c8979cab446
      size: 301346
    - path: filter/iv-exemplare.dat
      md5: 4b3b304868dd8535b843e3aea1df3ef2
      size: 4883282
    - path: filter/iv-titel.csv
      md5: 8805c4dd9e222b09ee3c09e5dfb6c8c1
      size: 996823
    - path: filter/schreibmeister-exemplare.dat
      md5: 1107d8b67970e68309925f36c99ec0dd
      size: 48638
    - path: filter/schreibmeister-titel.csv
      md5: b28124181b911371ed205b34facfc300
      size: 48316
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 52e6daa6b05693bf46dc4090b15bdb1c
      size: 37769
    - path: filter/böink-exemplare.dat
      md5: 2acc4e0328c7251009eb61a4f98c2b58
      size: 52947
    - path: filter/böink-titel.csv
      md5: f7af143539c6d2e6059fb4bc0ccef18f
      size: 19291
    - path: filter/böm-exemplare.dat
      md5: ce36d9bfac3bd9aa4e6d59c0e99c943e
      size: 145370
    - path: filter/böm-titel.csv
      md5: 9a347ea8adbdcf64ae4146971405a1f4
      size: 126184
    - path: filter/ii-exemplare.dat
      md5: 5d7afd43e0c3335417dda58048c3bfe1
      size: 10994035
    - path: filter/ii-titel.csv
      md5: 685aaedce6660c1cbd807d23df953261
      size: 100835
    - path: filter/iii-exemplare.dat
      md5: e9a0ed95b35c2bdbe758239dc3a85c6c
      size: 4737414
    - path: filter/iii-titel.csv
      md5: 6afdba346b7b21abef2f3c8979cab446
      size: 301346
    - path: filter/iv-exemplare.dat
      md5: 4b3b304868dd8535b843e3aea1df3ef2
      size: 4883282
    - path: filter/iv-titel.csv
      md5: 8805c4dd9e222b09ee3c09e5dfb6c8c1
      size: 996823
    - path: filter/schreibmeister-exemplare.dat
      md5: 1107d8b67970e68309925f36c99ec0dd
      size: 48638
    - path: filter/schreibmeister-titel.csv
      md5: b28124181b911371ed205b34facfc300
      size: 48316
    - path: listen_in/böink.xlsx
      md5: 9b94cd3ed61d6f0d643cb707ac8ac88a
      size: 73138
    - path: listen_in/böm.xlsx
      md5: d47476361021475f147dc8b5260a1869
      size: 152069
    - path: listen_in/ii.xlsx
      md5: c0177ca26827726dd112e962a5c454f9
      size: 158589
    - path: listen_in/iii.xlsx
      md5: 1f3ae64bd9f38ce17ef25b5d144fd91f
      size: 265248
    - path: listen_in/iv.xlsx
      md5: fad63467b6bca68c269bc6967e5d8634
      size: 770689
    - path: listen_in/schreibmeister.xlsx
      md5: 768853f8124c61736e79428aae7c92a9
      size: 119907
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: 049378da0cb3e57260cb9988a9afc472
      size: 40536
    - path: abzug/böink.xlsx
      md5: 7a8a66d89a5d0de93cf2de1b7016fcdf
      size: 28192
    - path: abzug/böm.csv
      md5: 0ed6f13b2c84fc6ed992f47684ff4b23
      size: 108438
    - path: abzug/böm.xlsx
      md5: aeae899545460789eb249f617a6dba9a
      size: 67215
    - path: abzug/ii.csv
      md5: 756b8795e55f6fc6e157a56b9ad97cf5
      size: 96369
    - path: abzug/ii.xlsx
      md5: dc566f696a32cb3e6314f05f093b0bf3
      size: 61467
    - path: abzug/iii.csv
      md5: 32febb18588830d97f825eaf79f87b6c
      size: 247951
    - path: abzug/iii.xlsx
      md5: 2d156ae67dff2861704a390ddc623d01
      size: 144830
    - path: abzug/iv.csv
      md5: 6a46dd2db24e34821966d5714dbfcc85
      size: 839532
    - path: abzug/iv.xlsx
      md5: afbca0e423aacc6e8e533013f430f4a6
      size: 429379
    - path: abzug/schreibmeister.csv
      md5: 00aff2795a9598b338890bb01b497aba
      size: 54281
    - path: abzug/schreibmeister.xlsx
      md5: 19f497c637e3c5a6ec2b863ff8ff2383
      size: 34616
    - path: listen_out/böink.xlsx
      md5: edc4883ef65e33aae21532d175538312
      size: 140899
    - path: listen_out/böm.xlsx
      md5: 1c8b1ed9ee2f5284fb8dbcbf7f0cb174
      size: 280798
    - path: listen_out/ii.xlsx
      md5: fef80824e5bb0de5c9f1721978944833
      size: 346290
    - path: listen_out/iii.xlsx
      md5: 9d43d44fb004ed158aa9467634f9d619
      size: 557807
    - path: listen_out/iv.xlsx
      md5: c2f02288fee9992239ef0d8ff06be97f
      size: 2224817
    - path: listen_out/schreibmeister.xlsx
      md5: 4933930fc68ec061d4a2ded0b9fad50b
      size: 167245
