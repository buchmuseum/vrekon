schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 0de14caf6cdd65e5b0204622eec8ce0f
      size: 7796659724
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 3913b003cf5295ace5bcbebdf6adf5cc
      size: 127925990
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'III'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 3913b003cf5295ace5bcbebdf6adf5cc
      size: 127925990
    outs:
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: 707e4308a2e48466921974522c143230
      size: 19497
    - path: filter/böm-exemplare.dat
      md5: 6f3739dd38b9b8cf47c85a89ad952554
      size: 131617
    - path: filter/böm-titel.csv
      md5: 2ea04759a1bb4839ab683a292400e381
      size: 126574
    - path: filter/ii-exemplare.dat
      md5: d2fc30d0697fac4114f1c22ff541df9d
      size: 9465141
    - path: filter/ii-titel.csv
      md5: 90f185f1f67201e948f8a5c46a1c2fd7
      size: 108577
    - path: filter/iii-exemplare.dat
      md5: a42bb4c4f4e4f6acf616e9a82ba65212
      size: 4010156
    - path: filter/iii-titel.csv
      md5: f3a0f99f2d3e35038573c46c58707150
      size: 302432
    - path: filter/iv-exemplare.dat
      md5: ed1a683b31b076f6cae102527e4af7f8
      size: 4215031
    - path: filter/iv-titel.csv
      md5: f7661b38509591e512b47140236430bf
      size: 1016057
    - path: filter/schreibmeister-exemplare.dat
      md5: 5a08ec5a121ce9da6cb91217d2036868
      size: 42238
    - path: filter/schreibmeister-titel.csv
      md5: 9949f2b27b6d6b5f3824c678e7646bfa
      size: 47033
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 7a745c27820b3745cf7e756596c70cb1
      size: 36856
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: 707e4308a2e48466921974522c143230
      size: 19497
    - path: filter/böm-exemplare.dat
      md5: 6f3739dd38b9b8cf47c85a89ad952554
      size: 131617
    - path: filter/böm-titel.csv
      md5: 2ea04759a1bb4839ab683a292400e381
      size: 126574
    - path: filter/ii-exemplare.dat
      md5: d2fc30d0697fac4114f1c22ff541df9d
      size: 9465141
    - path: filter/ii-titel.csv
      md5: 90f185f1f67201e948f8a5c46a1c2fd7
      size: 108577
    - path: filter/iii-exemplare.dat
      md5: a42bb4c4f4e4f6acf616e9a82ba65212
      size: 4010156
    - path: filter/iii-titel.csv
      md5: f3a0f99f2d3e35038573c46c58707150
      size: 302432
    - path: filter/iv-exemplare.dat
      md5: ed1a683b31b076f6cae102527e4af7f8
      size: 4215031
    - path: filter/iv-titel.csv
      md5: f7661b38509591e512b47140236430bf
      size: 1016057
    - path: filter/schreibmeister-exemplare.dat
      md5: 5a08ec5a121ce9da6cb91217d2036868
      size: 42238
    - path: filter/schreibmeister-titel.csv
      md5: 9949f2b27b6d6b5f3824c678e7646bfa
      size: 47033
    - path: listen_in/böink.xlsx
      md5: a0d845db5109746663bc7b6b82e139a0
      size: 71503
    - path: listen_in/böm.xlsx
      md5: 0debb13553937b0800df8fb5dc36a585
      size: 151770
    - path: listen_in/ii.xlsx
      md5: 7c9a15d673f4a90e4330e1aef835b3bf
      size: 155638
    - path: listen_in/iii.xlsx
      md5: 75738bd944228807f8d7ac069dd58325
      size: 242036
    - path: listen_in/iv.xlsx
      md5: 1144d712f25aa3d152dec7f02b029ff5
      size: 807318
    - path: listen_in/schreibmeister.xlsx
      md5: b3431595b70a9412f74efddd9ededce3
      size: 115564
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: cecb064673d2bf88e0fd020c7514a44e
      size: 39227
    - path: abzug/böink.xlsx
      md5: 7e464e1359c13d7759c6051279ffd8e7
      size: 27517
    - path: abzug/böm.csv
      md5: dc273a1625ac28dade1230b2e4166aa3
      size: 105246
    - path: abzug/böm.xlsx
      md5: a905b3250a8d71ec6f081d9926dac5c7
      size: 65207
    - path: abzug/ii.csv
      md5: 809ead2dbd3592700e0a130928f1eb9e
      size: 95971
    - path: abzug/ii.xlsx
      md5: 4f05a266fdcc8029973d992156b9703c
      size: 61235
    - path: abzug/iii.csv
      md5: b1d19dfc1b994a5604a0f1cd3b44edca
      size: 212363
    - path: abzug/iii.xlsx
      md5: 548ac4283c2c2813672e9dfde44750cd
      size: 123590
    - path: abzug/iv.csv
      md5: fd13991be1ffe33adec69f78539b1f60
      size: 824067
    - path: abzug/iv.xlsx
      md5: 1f977b925dfd5ddbfa23c1b9f1711de8
      size: 423474
    - path: abzug/schreibmeister.csv
      md5: 095ad2c8867dab474f5b56cf1a11f9ee
      size: 52848
    - path: abzug/schreibmeister.xlsx
      md5: fce21e5c62ba55accdf72297d18bf569
      size: 33676
    - path: listen_out/böink.xlsx
      md5: ecc3f24a425cc6a5215142dbecd7a03b
      size: 138933
    - path: listen_out/böm.xlsx
      md5: a19cab6759e8d17d41b044e922c0c9da
      size: 276790
    - path: listen_out/ii.xlsx
      md5: 22c225cf6dbeb4306dfbd968f7eda893
      size: 343046
    - path: listen_out/iii.xlsx
      md5: 6fd08499d7c17c1554ef45e15a053b37
      size: 533907
    - path: listen_out/iv.xlsx
      md5: 8d650e9a65a4c6f54b77a56b5f26fdd0
      size: 2383089
    - path: listen_out/schreibmeister.xlsx
      md5: 30b7f275e1491c3d7d2575180d00e220
      size: 163775
