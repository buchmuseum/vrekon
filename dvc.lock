schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 59b14239c94a2cd2996c79dc1c31dfac
      size: 7385446761
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: f3861788f3e212918d69dd3da870dd26
      size: 124802285
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz
      | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'Bö
      Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica print
      --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =~ '^II[\\\s\\\d]'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'III'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "209A/*.a =^ 'IV'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039D.9,039I.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --reduce "003@,209A,209C,247C,237A,101@,220C" "044P/*.9 == '041799844'"
      dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: f3861788f3e212918d69dd3da870dd26
      size: 124802285
    outs:
    - path: filter/böink-exemplare.dat
      md5: faa435f309b2c4e68c08ef95340075f7
      size: 48172
    - path: filter/böink-titel.csv
      md5: c1ca02354fcf8681230d4b395557036a
      size: 19218
    - path: filter/böm-exemplare.dat
      md5: 5cf72142e9e13b9504a7e69b51e2fc1c
      size: 135348
    - path: filter/böm-titel.csv
      md5: ffbfbde508e304802c8b34588750d26f
      size: 127423
    - path: filter/ii-exemplare.dat
      md5: 9c793130aa62a1ba0dea3d53cffb2c65
      size: 9549925
    - path: filter/ii-titel.csv
      md5: f147ea3e05fda366f0f7e4c517962be9
      size: 108365
    - path: filter/iii-exemplare.dat
      md5: 4a23137d3793a83dbffe636e39738588
      size: 4100595
    - path: filter/iii-titel.csv
      md5: ba30f15960723a91546bbe0712ed978e
      size: 299957
    - path: filter/iv-exemplare.dat
      md5: 8606eb9e709a83d2784788f7b0d5a59b
      size: 4169775
    - path: filter/iv-titel.csv
      md5: 9baeb89c6be401d9e85610bd6d4b09fc
      size: 1015717
    - path: filter/schreibmeister-exemplare.dat
      md5: a5d88c966c85093827925267c5c6c292
      size: 38391
    - path: filter/schreibmeister-titel.csv
      md5: bccd9707ba3045d1030ff3fef485c8cc
      size: 40875
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 7ce4c3adbbf30a8a9aa6e468fff2344c
      size: 3398
    - path: filter/böink-exemplare.dat
      md5: faa435f309b2c4e68c08ef95340075f7
      size: 48172
    - path: filter/böink-titel.csv
      md5: c1ca02354fcf8681230d4b395557036a
      size: 19218
    - path: filter/böm-exemplare.dat
      md5: 5cf72142e9e13b9504a7e69b51e2fc1c
      size: 135348
    - path: filter/böm-titel.csv
      md5: ffbfbde508e304802c8b34588750d26f
      size: 127423
    - path: filter/ii-exemplare.dat
      md5: 9c793130aa62a1ba0dea3d53cffb2c65
      size: 9549925
    - path: filter/ii-titel.csv
      md5: f147ea3e05fda366f0f7e4c517962be9
      size: 108365
    - path: filter/iii-exemplare.dat
      md5: 4a23137d3793a83dbffe636e39738588
      size: 4100595
    - path: filter/iii-titel.csv
      md5: ba30f15960723a91546bbe0712ed978e
      size: 299957
    - path: filter/iv-exemplare.dat
      md5: 8606eb9e709a83d2784788f7b0d5a59b
      size: 4169775
    - path: filter/iv-titel.csv
      md5: 9baeb89c6be401d9e85610bd6d4b09fc
      size: 1015717
    - path: filter/schreibmeister-exemplare.dat
      md5: a5d88c966c85093827925267c5c6c292
      size: 38391
    - path: filter/schreibmeister-titel.csv
      md5: bccd9707ba3045d1030ff3fef485c8cc
      size: 40875
    - path: listen_in/böink.xlsx
      md5: a6b13baf5db3473baf2590bd42e83881
      size: 123876
    - path: listen_in/böm.xlsx
      md5: 46cb8ac9b9b0673cff5fb76caae52246
      size: 255084
    - path: listen_in/ii.xlsx
      md5: 553e5875b68ba5e133676dce8e15aec1
      size: 311435
    - path: listen_in/iii.xlsx
      md5: 1dddd3048e613a533f781dcec62b1f44
      size: 488080
    - path: listen_in/iv.xlsx
      md5: eba10b114a9fc8363ed25af1d0aab7f7
      size: 818137
    - path: listen_in/schreibmeister.xlsx
      md5: 615fa2b142564c922bcc25968fec3d77
      size: 142222
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: fabc012da3b9de4f1b6d076d5c78980a
      size: 40143
    - path: abzug/böink.xlsx
      md5: f8bd374bf8b8393c6bfd9c06e3578c7b
      size: 27956
    - path: abzug/böm.csv
      md5: 2c4d07f1f5815445e2801d14d3233aa0
      size: 107699
    - path: abzug/böm.xlsx
      md5: 3275fc04e3e8238e32215be18444b9fb
      size: 66634
    - path: abzug/ii.csv
      md5: 3cd422055ceb698a5e99d5cd3b5011cc
      size: 97175
    - path: abzug/ii.xlsx
      md5: c8739a1b2cef9c4e4d3d0ff1933d7c5b
      size: 61805
    - path: abzug/iii.csv
      md5: 6bf119d5e9913e2c69b234e377c61f87
      size: 241789
    - path: abzug/iii.xlsx
      md5: 354d6c0c717ee94ee6ee3a1e40f3c295
      size: 139169
    - path: abzug/iv.csv
      md5: 4ffc2ad792b4d9f73648a6288f4b359f
      size: 1004280
    - path: abzug/iv.xlsx
      md5: 086cbeff4d224e537b2031963011da62
      size: 503640
    - path: abzug/schreibmeister.csv
      md5: 209f81395f45bc7656bc0325153f9961
      size: 50048
    - path: abzug/schreibmeister.xlsx
      md5: 90ced83325aa3cde19bdc6f5448bc3fc
      size: 32781
    - path: listen_out/böink.xlsx
      md5: 4b29580ffde77b1c9b4849c12e795602
      size: 123932
    - path: listen_out/böm.xlsx
      md5: eb259b650690d8555a3b8b2905d194c3
      size: 255086
    - path: listen_out/ii.xlsx
      md5: c54257b641e3b1eb4d2651bb5bc51c8b
      size: 313089
    - path: listen_out/iii.xlsx
      md5: d8bf5e1fdca791ae3946437679e40fd1
      size: 488306
    - path: listen_out/iv.xlsx
      md5: f7aaa4a2678c083bdc0487fa55aef30b
      size: 2245917
    - path: listen_out/schreibmeister.xlsx
      md5: 895dfb3d37e7840ac1f80c5da1013ae6
      size: 142271
