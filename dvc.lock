schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: b4f65f4184a317a2fba06bd365def81c
      size: 8098111127
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 7f1745e534addbcf7979c80096ec8917
      size: 129832703
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'III'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 7f1745e534addbcf7979c80096ec8917
      size: 129832703
    outs:
    - path: filter/böink-exemplare.dat
      md5: 4044bf0086e5b347c58d824ac81d2431
      size: 48871
    - path: filter/böink-titel.csv
      md5: 396cd9e304f4545dce418a9c7ff3010a
      size: 19497
    - path: filter/böm-exemplare.dat
      md5: d9685c2bbfb11a16e695f387ca31c12c
      size: 131808
    - path: filter/böm-titel.csv
      md5: 25a75a7a4d662c2db49286476f36d452
      size: 126584
    - path: filter/ii-exemplare.dat
      md5: 9f849b835fe102c78fdfe80a568bc452
      size: 9491528
    - path: filter/ii-titel.csv
      md5: 044af411b6c990cf5f360381783956b2
      size: 108607
    - path: filter/iii-exemplare.dat
      md5: c344858b2ce36220290ebe9a7ea82a6a
      size: 4044469
    - path: filter/iii-titel.csv
      md5: 7b6ea35078993098015427b67bafdbf5
      size: 302170
    - path: filter/iv-exemplare.dat
      md5: 3779305be231fba2822dfc671c561777
      size: 4243745
    - path: filter/iv-titel.csv
      md5: ce0c3cd78f47add3fcf656fc4001221b
      size: 1017890
    - path: filter/schreibmeister-exemplare.dat
      md5: e6e49454adb453ff2af037ae7f99f4b8
      size: 42323
    - path: filter/schreibmeister-titel.csv
      md5: e7677f2d08a79f5f7aab9dc789fd4080
      size: 47253
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 65397161be4213a051affcd6b155c138
      size: 37027
    - path: filter/böink-exemplare.dat
      md5: 4044bf0086e5b347c58d824ac81d2431
      size: 48871
    - path: filter/böink-titel.csv
      md5: 396cd9e304f4545dce418a9c7ff3010a
      size: 19497
    - path: filter/böm-exemplare.dat
      md5: d9685c2bbfb11a16e695f387ca31c12c
      size: 131808
    - path: filter/böm-titel.csv
      md5: 25a75a7a4d662c2db49286476f36d452
      size: 126584
    - path: filter/ii-exemplare.dat
      md5: 9f849b835fe102c78fdfe80a568bc452
      size: 9491528
    - path: filter/ii-titel.csv
      md5: 044af411b6c990cf5f360381783956b2
      size: 108607
    - path: filter/iii-exemplare.dat
      md5: c344858b2ce36220290ebe9a7ea82a6a
      size: 4044469
    - path: filter/iii-titel.csv
      md5: 7b6ea35078993098015427b67bafdbf5
      size: 302170
    - path: filter/iv-exemplare.dat
      md5: 3779305be231fba2822dfc671c561777
      size: 4243745
    - path: filter/iv-titel.csv
      md5: ce0c3cd78f47add3fcf656fc4001221b
      size: 1017890
    - path: filter/schreibmeister-exemplare.dat
      md5: e6e49454adb453ff2af037ae7f99f4b8
      size: 42323
    - path: filter/schreibmeister-titel.csv
      md5: e7677f2d08a79f5f7aab9dc789fd4080
      size: 47253
    - path: listen_in/böink.xlsx
      md5: 56e70dc5f011056b3ea184dfec60ffdd
      size: 71569
    - path: listen_in/böm.xlsx
      md5: 29f6de1f611496abd7e4a460001395c3
      size: 150787
    - path: listen_in/ii.xlsx
      md5: a544f4d415564620a18798613d596baa
      size: 156042
    - path: listen_in/iii.xlsx
      md5: 324bda6561c988dbe2281c90d3920800
      size: 242751
    - path: listen_in/iv.xlsx
      md5: c6cb6eb1e2e860710b26f5a16574daa7
      size: 808343
    - path: listen_in/schreibmeister.xlsx
      md5: b8ce7e7dd2c71ab35543d0d34dcbdc26
      size: 116349
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: def723c5cf7121aabc19f5de6406420d
      size: 39527
    - path: abzug/böink.xlsx
      md5: a51f0c05f6b4837c11df64718e855c22
      size: 27759
    - path: abzug/böm.csv
      md5: b5ea945091bfbdeb3494866de14175b6
      size: 108027
    - path: abzug/böm.xlsx
      md5: 9a1f429078bf92f367abf010a9e37c70
      size: 66922
    - path: abzug/ii.csv
      md5: 4ae2cf82c272d9058b36e77b9922b652
      size: 96268
    - path: abzug/ii.xlsx
      md5: 419e8dc23a4c0a5a8955f7423c8201b6
      size: 61565
    - path: abzug/iii.csv
      md5: 2c751d58081cfd6f1a7fb65275ae46de
      size: 244362
    - path: abzug/iii.xlsx
      md5: 18e319edb18dd4d36389788d72d918c7
      size: 141203
    - path: abzug/iv.csv
      md5: d7266a3592b8687b2688ac53836abbcd
      size: 828527
    - path: abzug/iv.xlsx
      md5: 48f3a27ec5c50d40e893796441bab6de
      size: 425192
    - path: abzug/schreibmeister.csv
      md5: a136583a259257e93802ab1984edf5b8
      size: 52962
    - path: abzug/schreibmeister.xlsx
      md5: 76cfd76344b8fb2630ca9c3b1f976ab3
      size: 33799
    - path: listen_out/böink.xlsx
      md5: 1a0bc7aa9cc61bb2c795f425b73617e0
      size: 139199
    - path: listen_out/böm.xlsx
      md5: 6ab3a5996036f8aefe5cede8be099505
      size: 277884
    - path: listen_out/ii.xlsx
      md5: 014c72e70773c9ab1145678449ebfe20
      size: 343339
    - path: listen_out/iii.xlsx
      md5: c5b9841805b22597d16b2d4c23caacd1
      size: 545668
    - path: listen_out/iv.xlsx
      md5: 54d558aa04a321a26e0fe37142d21a76
      size: 2391127
    - path: listen_out/schreibmeister.xlsx
      md5: 3fac9da607127dade35977f10f7d46e4
      size: 164131
