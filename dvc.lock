schema: '2.0'
stages:
  prepare:
    cmd:
    - "if [ ! -d \"dump/\" ]; then\n  mkdir dump\nfi\n"
    - "if [ ! -d \"filter/\" ]; then\n  mkdir filter\nfi\n"
    - "if [ ! -d \"abzug/\" ]; then\n  mkdir abzug\nfi\n"
    - "if [ ! -d \"listen_out/\" ]; then\n  mkdir listen_out\nfi\n"
    - pica filter -s -g "017A.a =^ 'yy' || 209A/*.f =^ 'DBSM' || 247C/*.9 == '009033645'"
      raw/DNBtitelundexemplare.dat.gz -o dump/dbsm-titel-exemplare.dat.gz
    deps:
    - path: raw/DNBtitelundexemplare.dat.gz
      md5: 0de14caf6cdd65e5b0204622eec8ce0f
      size: 7796659724
    outs:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 3913b003cf5295ace5bcbebdf6adf5cc
      size: 127925990
  filter:
    cmd:
    - pica filter "209A/*.a =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe
      M' || 209A/*.g =^ 'Boe M'" dump/dbsm-titel-exemplare.dat.gz | pica select --translit
      nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a,f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böm-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö M' || 209A/*.g =^ 'Bö M' || 209A/*.a =^ 'Boe M' || 209A/*.g =^ 'Boe
      M'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/böm-exemplare.dat
    - pica filter "209A/*.a =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/böink-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'Bö Ink' || 209A/*.g =^ 'Bö Ink'" dump/dbsm-titel-exemplare.dat.gz | pica
      print --translit nfc -o filter/böink-exemplare.dat
    - pica filter "209A/*.a =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz |
      pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/ii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =~ '^II[\\\s\\\d]'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit
      nfc -o filter/ii-exemplare.dat
    - pica filter "209A/*.a =^ 'III' || 209A/*.g =^ 'III'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iii-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'III'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iii-exemplare.dat
    - pica filter "209A/*.a =^ 'IV' || 209A/*.g =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz
      | pica select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y, umfang, stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/iv-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "209A/*.a
      =^ 'IV'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc -o filter/iv-exemplare.dat
    - pica filter "044P/*.9 == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica
      select --translit nfc "003@.0,002@.0,011@.a,021A{a,d},021A{Y?,Y},034D.a,021B{l,a},039I.9,039D.9,039B.9,036H{9,g}"
      -H "idn,bbg,jahr,tit_a, tit_d, tit_Y,umfang,stuecktitel_l,stuecktitel_a, f4256,f4243,f4241,f4105_9,f4105_g"
      -o filter/schreibmeister-titel.csv
    - pica filter --keep "003@,209A/*,209C/*,247C/*,237A/*,101@/*,220C/*" "044P/*.9
      == '041799844'" dump/dbsm-titel-exemplare.dat.gz | pica print --translit nfc
      -o filter/schreibmeister-exemplare.dat
    deps:
    - path: dump/dbsm-titel-exemplare.dat.gz
      md5: 3913b003cf5295ace5bcbebdf6adf5cc
      size: 127925990
    outs:
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: 396cd9e304f4545dce418a9c7ff3010a
      size: 19497
    - path: filter/böm-exemplare.dat
      md5: 6f3739dd38b9b8cf47c85a89ad952554
      size: 131617
    - path: filter/böm-titel.csv
      md5: 23a9b6ee388bbc43584c4ad9c95810d1
      size: 126574
    - path: filter/ii-exemplare.dat
      md5: d2fc30d0697fac4114f1c22ff541df9d
      size: 9465141
    - path: filter/ii-titel.csv
      md5: d5319096193f28db86b0690498604819
      size: 108577
    - path: filter/iii-exemplare.dat
      md5: a42bb4c4f4e4f6acf616e9a82ba65212
      size: 4010156
    - path: filter/iii-titel.csv
      md5: 590a1fb4715f45986b950fa283705f4e
      size: 302432
    - path: filter/iv-exemplare.dat
      md5: ed1a683b31b076f6cae102527e4af7f8
      size: 4215031
    - path: filter/iv-titel.csv
      md5: 2298dc2b927a1a44df71b958f065c324
      size: 1016057
    - path: filter/schreibmeister-exemplare.dat
      md5: 5a08ec5a121ce9da6cb91217d2036868
      size: 42238
    - path: filter/schreibmeister-titel.csv
      md5: 402040e381dcda209e05b6bbb023d7da
      size: 47033
  abzug:
    cmd:
    - python ./skripte/abzug.py
    deps:
    - path: blacklist.txt
      md5: 7a745c27820b3745cf7e756596c70cb1
      size: 36856
    - path: filter/böink-exemplare.dat
      md5: e5a10e323b753d7d8a70e3bc4b45feab
      size: 48843
    - path: filter/böink-titel.csv
      md5: 396cd9e304f4545dce418a9c7ff3010a
      size: 19497
    - path: filter/böm-exemplare.dat
      md5: 6f3739dd38b9b8cf47c85a89ad952554
      size: 131617
    - path: filter/böm-titel.csv
      md5: 23a9b6ee388bbc43584c4ad9c95810d1
      size: 126574
    - path: filter/ii-exemplare.dat
      md5: d2fc30d0697fac4114f1c22ff541df9d
      size: 9465141
    - path: filter/ii-titel.csv
      md5: d5319096193f28db86b0690498604819
      size: 108577
    - path: filter/iii-exemplare.dat
      md5: a42bb4c4f4e4f6acf616e9a82ba65212
      size: 4010156
    - path: filter/iii-titel.csv
      md5: 590a1fb4715f45986b950fa283705f4e
      size: 302432
    - path: filter/iv-exemplare.dat
      md5: ed1a683b31b076f6cae102527e4af7f8
      size: 4215031
    - path: filter/iv-titel.csv
      md5: 2298dc2b927a1a44df71b958f065c324
      size: 1016057
    - path: filter/schreibmeister-exemplare.dat
      md5: 5a08ec5a121ce9da6cb91217d2036868
      size: 42238
    - path: filter/schreibmeister-titel.csv
      md5: 402040e381dcda209e05b6bbb023d7da
      size: 47033
    - path: listen_in/böink.xlsx
      md5: cb21bba66fc8f058c4b81a041d7b92b9
      size: 71199
    - path: listen_in/böm.xlsx
      md5: a208ec3f94800b2d2730486e35bcc6d6
      size: 148116
    - path: listen_in/ii.xlsx
      md5: b4d43d740c1848fd23951f24e455bb8b
      size: 155585
    - path: listen_in/iii.xlsx
      md5: 7745348454e564234b4d959a7bc6e0d6
      size: 235553
    - path: listen_in/iv.xlsx
      md5: b014b974a7b8be673edfbb586cb2d9a1
      size: 803724
    - path: listen_in/schreibmeister.xlsx
      md5: 49280cbee3dfa8cb45a0afcc6b2adaec
      size: 114704
    - path: skripte/abzug.py
      md5: 824d7bcd2b46df6b88143c37071a0d71
      size: 17747
    outs:
    - path: abzug/böink.csv
      md5: def723c5cf7121aabc19f5de6406420d
      size: 39527
    - path: abzug/böink.xlsx
      md5: 755f30f101cf1ea2429e88443e880668
      size: 27758
    - path: abzug/böm.csv
      md5: 369ad21f2faf9614c5de4d8d83845dfa
      size: 108017
    - path: abzug/böm.xlsx
      md5: b771d2a87b24c60e449c4423ebf984fc
      size: 66888
    - path: abzug/ii.csv
      md5: 838551d55ce04841754d95eec461b38b
      size: 96238
    - path: abzug/ii.xlsx
      md5: 99d9ba0970f346bedca6e885d95518a7
      size: 61381
    - path: abzug/iii.csv
      md5: ee33493040c8370f95a0f282b2e56098
      size: 244702
    - path: abzug/iii.xlsx
      md5: dd74414ad594f4f3c1a7a11bb53d4ac0
      size: 141389
    - path: abzug/iv.csv
      md5: 161059fcac3f96c0c866c6052fcf6a40
      size: 827018
    - path: abzug/iv.xlsx
      md5: 989cbd9ff17c07bbf8183e887b616b0d
      size: 424483
    - path: abzug/schreibmeister.csv
      md5: 7a1865fb5c1160c409650f1fc7ffa69c
      size: 52848
    - path: abzug/schreibmeister.xlsx
      md5: 0a8bd8d1397e8fec6d1e6e557a9fc21e
      size: 33678
    - path: listen_out/böink.xlsx
      md5: 6e6330047fd2d2f340e457b37e409a56
      size: 139131
    - path: listen_out/böm.xlsx
      md5: da049dfc6e9b91e36bd20b55808f7a9d
      size: 277845
    - path: listen_out/ii.xlsx
      md5: 18775aac171aa3096543df08eb9e0fa1
      size: 343181
    - path: listen_out/iii.xlsx
      md5: 7c8c946a8392faddc03d8f4f2b4f575e
      size: 549655
    - path: listen_out/iv.xlsx
      md5: 71bc4aee9db49f28a5a00df9a3742110
      size: 2386445
    - path: listen_out/schreibmeister.xlsx
      md5: 5ef49b681e0a9adc35e24121062c2289
      size: 163757
